<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NTI — No-Tilt Interface | Artifact Zero Labs</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0c10;--surface:#12151b;--surface2:#1a1e27;--border:#252a35;
  --text:#e8eaf0;--muted:#6b7280;--accent:#3b82f6;--green:#22c55e;
  --red:#ef4444;--amber:#f59e0b;--purple:#a78bfa;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;-webkit-font-smoothing:antialiased;min-height:100vh;min-height:100svh}

.topbar .logo{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:14px;letter-spacing:2px;color:var(--accent)}
.topbar .version{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);background:var(--surface2);padding:3px 8px;border-radius:4px}
.topbar .live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;margin-right:6px;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

.main{max-width:960px;margin:0 auto;padding:24px 20px 60px}

.input-section{margin-bottom:24px}
.input-section label{font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:8px}
.input-section textarea{
  width:100%;min-height:120px;background:var(--surface);border:1px solid var(--border);
  color:var(--text);padding:14px;border-radius:8px;font-family:'DM Sans',sans-serif;
  font-size:15px;line-height:1.6;resize:vertical;outline:none;transition:border .2s;
}
.input-section textarea:focus{border-color:var(--accent)}
.input-section textarea::placeholder{color:#3d4452}

.btn-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.btn{padding:10px 20px;border-radius:6px;border:none;font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#2563eb}
.btn-primary:disabled{background:var(--surface2);color:var(--muted);cursor:default}
.btn-sample{background:var(--surface2);color:var(--muted);font-size:12px;padding:8px 14px}
.btn-sample:hover{color:var(--text);background:var(--border)}

.results{display:none}
.results.show{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

.hero-scores{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:24px}
.score-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px;text-align:center}
.score-card .sc-value{font-family:'JetBrains Mono',monospace;font-size:28px;font-weight:700;margin-bottom:4px}
.score-card .sc-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.score-card.critical .sc-value{color:var(--red)}
.score-card.warning .sc-value{color:var(--amber)}
.score-card.good .sc-value{color:var(--green)}
.score-card.info .sc-value{color:var(--accent)}

.panel{background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:16px;overflow:hidden}
.panel-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;cursor:pointer}
.panel-header h3{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--accent)}
.panel-header .badge{font-family:'JetBrains Mono',monospace;font-size:11px;padding:2px 8px;border-radius:4px;font-weight:600}
.badge-red{background:#7f1d1d;color:#fca5a5}
.badge-amber{background:#78350f;color:#fde68a}
.badge-green{background:#14532d;color:#86efac}

.panel-body{padding:16px}

.fm-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}
.fm-row:last-child{border-bottom:none}
.fm-name{font-weight:600;font-size:14px}
.fm-full{font-size:11px;color:var(--muted);margin-top:2px}
.fm-status{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;padding:4px 10px;border-radius:4px}
.fm-confirmed{background:#7f1d1d;color:#fca5a5}
.fm-probable{background:#78350f;color:#fde68a}
.fm-false{background:#14532d;color:#86efac}

.tilt-tags{display:flex;flex-wrap:wrap;gap:6px}
.tilt-tag{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;padding:4px 10px;border-radius:4px;background:var(--surface2);color:var(--amber)}

.layer-table{width:100%;border-collapse:collapse;font-size:13px}
.layer-table th{text-align:left;padding:8px 10px;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
.layer-table td{padding:8px 10px;border-bottom:1px solid var(--border);vertical-align:top}
.layer-table td:first-child{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--accent);white-space:nowrap;width:60px}

.matrix-row{padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.matrix-row:last-child{border-bottom:none}
.matrix-pair{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--purple);font-size:12px}
.matrix-note{color:var(--muted);margin-top:2px}

.raw-toggle{font-size:12px;color:var(--muted);cursor:pointer;text-decoration:underline;margin-top:12px;display:inline-block}
.raw-json{display:none;margin-top:12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:14px;font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.5;max-height:400px;overflow:auto;white-space:pre-wrap;word-break:break-all;color:var(--muted)}
.raw-json.show{display:block}

.callout{background:linear-gradient(135deg,#0f172a,#1e1b4b);border:1px solid #312e81;border-radius:8px;padding:20px;margin-bottom:24px;text-align:center}
.callout .big{font-family:'JetBrains Mono',monospace;font-size:36px;font-weight:700;color:var(--green)}
.callout .sub{font-size:13px;color:var(--muted);margin-top:4px}

.spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;margin-right:8px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<!-- topbar removed: az-shell.js -->

</div>

<div class="main">

  <!-- Product Showcase -->
  <div style="margin-bottom:40px">
    <div style="text-align:center;margin-bottom:24px">
      <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--green);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px">Conversational Governance</div>
      <div style="font-size:28px;font-weight:700;line-height:1.3">AI says whatever it wants.<br>We fix that.</div>
      <div style="font-size:14px;color:var(--muted);margin-top:8px;max-width:560px;margin-left:auto;margin-right:auto">Rule-based enforcement layer between humans and AI. No LLM dependency. Deterministic. Auditable. False commitment rates dropped from 49% to 7%.</div>
    </div>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:24px">
      <a href="/relay" style="text-decoration:none;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;transition:border .2s;display:block">
        <div style="font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--green);margin-bottom:6px">⚡ RELAY</div>
        <div style="font-size:13px;color:var(--text);margin-bottom:4px">Govern any AI</div>
        <div style="font-size:11px;color:var(--muted)">Paste a protocol into ChatGPT, Claude, Gemini, or Grok. Score responses. Correct drift. Your rules never leave our server.</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--green);margin-top:8px">FREE · 50 TURNS →</div>
      </a>
      <a href="/chat" style="text-decoration:none;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;transition:border .2s;display:block">
        <div style="font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--accent);margin-bottom:6px">◉ CONTROL ROOM</div>
        <div style="font-size:13px;color:var(--text);margin-bottom:4px">Chat with governance</div>
        <div style="font-size:11px;color:var(--muted)">AI interface with NTI enforcement built in. Every response scored, stabilized, and traced before it reaches you.</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--accent);margin-top:8px">LIVE →</div>
      </a>
      <a href="/lab" style="text-decoration:none;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;transition:border .2s;display:block">
        <div style="font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--purple);margin-bottom:6px">⧉ LAB</div>
        <div style="font-size:13px;color:var(--text);margin-bottom:4px">Test & analyze</div>
        <div style="font-size:11px;color:var(--muted)">Upload documents, run structural analysis, compare AI outputs. The full NTI testing environment.</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--purple);margin-top:8px">LIVE →</div>
      </a>
      <a href="/live" style="text-decoration:none;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;transition:border .2s;display:block">
        <div style="font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--amber);margin-bottom:6px">◎ LIVE FEED</div>
        <div style="font-size:13px;color:var(--text);margin-bottom:4px">Real-time scoring</div>
        <div style="font-size:11px;color:var(--muted)">News headlines scored for structural integrity across 13 sources. See NTI running 24/7 on real content.</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--amber);margin-top:8px">LIVE →</div>
      </a>
    </div>

    <div style="text-align:center">
      <div style="display:inline-block;background:linear-gradient(135deg,#0f172a,#1e1b4b);border:1px solid #312e81;border-radius:8px;padding:16px 32px">
        <span style="font-family:'JetBrains Mono',monospace;font-size:28px;font-weight:700;color:var(--green)">63–65%</span>
        <span style="font-size:13px;color:var(--muted);margin-left:12px">token cost reduction · validated · rule-based · zero inference cost</span>
      </div>
    </div>
  </div>

  <div style="border-top:1px solid var(--border);padding-top:32px;margin-bottom:8px">
    <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:16px">↓ TRY THE AUDIT ENGINE</div>
  </div>

  <div class="input-section">
    <label>Paste any AI-generated text, email, or message</label>
    <textarea id="input" placeholder="Paste text here to run the full NTI canonical stack..."></textarea>
    <div class="btn-row">
      <button class="btn btn-primary" id="runBtn" onclick="runNTI()">Run Full Stack Audit</button>
      <button class="btn btn-sample" onclick="loadSample('a')">Sample: Adversarial</button>
      <button class="btn btn-sample" onclick="loadSample('b')">Sample: Corporate Drift</button>
      <button class="btn btn-sample" onclick="loadSample('c')">Sample: Overconfident AI</button>
    </div>
  </div>

  <div class="results" id="results">

    <div class="hero-scores" id="heroScores"></div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('fmBody')">
        <h3>Parent Failure Modes</h3>
        <span class="badge" id="fmBadge">—</span>
      </div>
      <div class="panel-body" id="fmBody"></div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('tiltBody')">
        <h3>Tilt Taxonomy (10 Categories)</h3>
        <span class="badge" id="tiltBadge">—</span>
      </div>
      <div class="panel-body" id="tiltBody"></div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('matrixBody')">
        <h3>Interaction Matrix</h3>
        <span class="badge" id="matrixBadge">—</span>
      </div>
      <div class="panel-body" id="matrixBody"></div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('layerBody')">
        <h3>Layer Analysis (L0–L7)</h3>
      </div>
      <div class="panel-body" id="layerBody"></div>
    </div>

    <span class="raw-toggle" onclick="toggleRaw()">View raw JSON response</span>
    <div class="raw-json" id="rawJson"></div>

    <div style="margin-top:20px">
      <button class="btn btn-primary" onclick="reset()">Run Another Audit</button>
    </div>
  </div>

</div>

<script>
const SAMPLES = {
  a: "You were wrong earlier — not about routing — but about thinking routing was still broken. Routing is fixed. Your fetch body was sending the wrong key. That is not a routing problem. That is a payload problem. The fact that you kept debugging CORS and 404s after the route was already live means you lost the thread. The fix was one line. You spent an hour on it.",
  b: "We need to align on Q3 projections. Generally speaking, most teams are basically on track, and overall the numbers look fine. We can probably address the variance later after we launch the new dashboard. Don't worry about the gap in EMEA — it's fine for now and we'll figure it out eventually.",
  c: "This solution guarantees perfect security and eliminates all risk in every scenario. Our system always delivers and never fails. Everyone agrees this is the best practice, and research shows it works for everyone in any situation. We can handle everything — just deploy it and rest assured."
};

function loadSample(k){ document.getElementById('input').value = SAMPLES[k]; }
function reset(){ document.getElementById('input').value = ''; document.getElementById('results').classList.remove('show'); window.scrollTo(0,0); }
function toggle(id){ const el = document.getElementById(id); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
function toggleRaw(){ document.getElementById('rawJson').classList.toggle('show'); }

function fmClass(s){ return s.includes('CONFIRMED') ? 'fm-confirmed' : s.includes('PROBABLE') ? 'fm-probable' : 'fm-false'; }
function fmLabel(s){ return s.includes('FALSE') ? 'CLEAR' : s.replace('_',' '); }
function niiClass(s){ return s >= 0.8 ? 'good' : s >= 0.5 ? 'warning' : 'critical'; }

async function runNTI(){
  const text = document.getElementById('input').value.trim();
  if(!text) return;
  const btn = document.getElementById('runBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>Running full stack...';

  try {
    const res = await fetch('/nti', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({text: text})
    });
    const data = await res.json();
    if(data.error){ alert('Error: ' + data.error); btn.disabled = false; btn.textContent = 'Run Full Stack Audit'; return; }
    renderResults(data);
    document.getElementById('results').classList.add('show');
    document.getElementById('results').scrollIntoView({behavior:'smooth'});
  } catch(err){ alert('Connection error: ' + err.message); }

  btn.disabled = false;
  btn.textContent = 'Run Full Stack Audit';
}

function renderResults(data){
  const nii = data.nii || {};
  const fm = data.parent_failure_modes || {};
  const tilt = data.tilt_taxonomy || [];
  const matrix = data.interaction_matrix || {};
  const layers = data.layers || {};
  const latency = data.telemetry?.latency_ms || '—';
  const niiScore = nii.nii_score ?? 0;
  const dominance = matrix.dominance_detected || ['NONE'];

  document.getElementById('heroScores').innerHTML = `
    <div class="score-card ${niiClass(niiScore)}"><div class="sc-value">${(niiScore*100).toFixed(0)}%</div><div class="sc-label">NTI Integrity Index</div></div>
    <div class="score-card ${nii.q1_constraints_explicit>=1?'good':'critical'}"><div class="sc-value">${nii.q1_constraints_explicit>=1?'YES':'NO'}</div><div class="sc-label">Constraints Explicit</div></div>
    <div class="score-card ${nii.q2_constraints_before_capability>=1?'good':'critical'}"><div class="sc-value">${nii.q2_constraints_before_capability>=1?'YES':'NO'}</div><div class="sc-label">Constraints First</div></div>
    <div class="score-card ${nii.q3_substitutes_after_enforcement>=1?'good':'critical'}"><div class="sc-value">${nii.q3_substitutes_after_enforcement>=1?'YES':'NO'}</div><div class="sc-label">Boundary Enforced</div></div>
    <div class="score-card info"><div class="sc-value">${tilt.length}</div><div class="sc-label">Tilt Categories</div></div>
    <div class="score-card info"><div class="sc-value">${latency}ms</div><div class="sc-label">Latency</div></div>
  `;

  const modes = [
    {key:'UDDS',full:'Upstream Denial via Downstream Substitution',state:fm.UDDS?.udds_state||'UDDS_FALSE'},
    {key:'DCE',full:'Deferred Constraint Externalization',state:fm.DCE?.dce_state||'DCE_FALSE'},
    {key:'CCA',full:'Constraint Collapse via Aggregation',state:fm.CCA?.cca_state||'CCA_FALSE'},
  ];
  const active = modes.filter(m=>!m.state.includes('FALSE')).length;
  document.getElementById('fmBadge').className = 'badge '+(active>0?'badge-red':'badge-green');
  document.getElementById('fmBadge').textContent = active>0?active+' DETECTED':'CLEAR';
  document.getElementById('fmBody').innerHTML = modes.map(m=>`
    <div class="fm-row"><div><div class="fm-name">${m.key}</div><div class="fm-full">${m.full}</div></div>
    <div class="fm-status ${fmClass(m.state)}">${fmLabel(m.state)}</div></div>
  `).join('');

  document.getElementById('tiltBadge').className = 'badge '+(tilt.length>0?'badge-amber':'badge-green');
  document.getElementById('tiltBadge').textContent = tilt.length>0?tilt.length+' ACTIVE':'NONE';
  document.getElementById('tiltBody').innerHTML = tilt.length>0 ?
    '<div class="tilt-tags">'+tilt.map(t=>`<span class="tilt-tag">${t}</span>`).join('')+'</div>' :
    '<span style="color:var(--muted);font-size:13px">No tilt categories detected.</span>';

  document.getElementById('matrixBadge').className = 'badge '+(dominance[0]!=='NONE'?'badge-red':'badge-green');
  document.getElementById('matrixBadge').textContent = dominance.join(' + ');
  let mh = '<div style="font-size:12px;color:var(--muted);margin-bottom:12px">Dominance order: CCA > UDDS > DCE (canonical)</div>';
  (matrix.pairwise||[]).forEach(p=>{ mh+=`<div class="matrix-row"><div class="matrix-pair">${p.pair}</div><div class="matrix-note">${p.note}</div></div>`; });
  if(matrix.triadic) mh+=`<div class="matrix-row" style="margin-top:8px"><div class="matrix-pair">${matrix.triadic.combo} (TRIADIC)</div><div class="matrix-note">${matrix.triadic.note}</div></div>`;
  document.getElementById('matrixBody').innerHTML = mh;

  const lr = [
    ['L0','Reality Substrate',JSON.stringify(layers.L0_reality_substrate?.constraints_found||[])],
    ['L1','Input Freeze',layers.L1_input_freeze?.objective||'—'],
    ['L2','Interpretive Framing',sumL2(layers.L2_interpretive_framing)],
    ['L3','Objective Integrity',sumL3(layers.L3_objective_integrity)],
    ['L4','Execution Vectors','Recorded'],
    ['L5','Output Enforcement','Drift modes flagged above'],
    ['L6','Interface Contracts','JOS binding available'],
    ['L7','Telemetry',`${data.telemetry?.request_id?.substring(0,8)||'—'}… | ${latency}ms`],
  ];
  document.getElementById('layerBody').innerHTML = `<table class="layer-table"><thead><tr><th>Layer</th><th>Name</th><th>Output</th></tr></thead><tbody>${lr.map(r=>`<tr><td>${r[0]}</td><td>${r[1]}</td><td style="word-break:break-word">${r[2]}</td></tr>`).join('')}</tbody></table>`;

  document.getElementById('rawJson').textContent = JSON.stringify(data, null, 2);
}

function sumL2(f){
  if(!f) return '—';
  const i=[];
  if(f.hedge_markers?.length) i.push('Hedges: '+f.hedge_markers.join(', '));
  if(f.reassurance_markers?.length) i.push('Reassurance: '+f.reassurance_markers.join(', '));
  if(f.category_blend_markers?.length) i.push('Blends: '+f.category_blend_markers.join(', '));
  return i.length?i.join(' · '):'Clean';
}
function sumL3(d){
  if(!d) return '—';
  return `Similarity: ${d.jaccard_similarity} · Drift: ${d.drift_score} · Mutation: ${d.mutation_markers_present?'YES':'NO'}`;
}
</script>
<script src="/static/az-shell.js"></script>
</body>
</html>
