<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artifact Zero ‚Äî Conversational Authority Infrastructure</title>
<link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06060a;--bg2:#0c0c14;--bg3:#14141f;--bg4:#1c1c2a;
  --fg:#e8e8f0;--fg2:#9090a8;--fg3:#5a5a72;--fg4:#3a3a4e;
  --green:#00e89c;--green2:#00c080;--green3:rgba(0,232,156,.12);
  --red:#ff4466;--red2:rgba(255,68,102,.12);
  --amber:#ffaa33;--amber2:rgba(255,170,51,.12);
  --blue:#448aff;--blue2:rgba(68,138,255,.12);
  --purple:#9966ff;--purple2:rgba(153,102,255,.12);
  --cyan:#00d4ff;--cyan2:rgba(0,212,255,.12);
  --mono:'Azeret Mono',monospace;--sans:'Outfit',sans-serif;
  --r:8px;--r2:12px;
}
html{font-size:15px;overflow-x:hidden}
body{background:var(--bg);color:var(--fg);font-family:var(--sans);min-height:100vh;overflow-x:hidden;scroll-behavior:auto}

/* App Layout - No Jumping */
.app-container{min-height:100vh;display:flex;flex-direction:column}
.app-header{padding:16px 28px;border-bottom:1px solid var(--bg3);display:flex;align-items:center;gap:12px;background:var(--bg);z-index:100;flex-shrink:0}
.app-header .logo{font-family:var(--mono);font-size:.85rem;font-weight:700;letter-spacing:2px;color:var(--green)}
.app-header .dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.app-body{flex:1;overflow-y:auto;padding:0}
.sections-container{max-width:1100px;margin:0 auto;padding:28px}

/* Persona Gate */
#persona-gate{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;position:relative}
.gate-logo{font-family:var(--mono);font-size:1rem;font-weight:700;letter-spacing:4px;color:var(--green);margin-bottom:8px;opacity:0;animation:fadeUp .6s .1s forwards}
.gate-title{font-family:var(--sans);font-size:2.4rem;font-weight:700;text-align:center;margin-bottom:8px;opacity:0;animation:fadeUp .6s .2s forwards}
.gate-sub{font-family:var(--sans);font-size:1rem;color:var(--fg2);text-align:center;max-width:520px;line-height:1.5;margin-bottom:48px;opacity:0;animation:fadeUp .6s .3s forwards}
.gate-question{font-family:var(--mono);font-size:.75rem;color:var(--fg3);text-transform:uppercase;letter-spacing:2px;margin-bottom:20px;opacity:0;animation:fadeUp .6s .4s forwards}
.persona-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;max-width:900px;width:100%;opacity:0;animation:fadeUp .6s .5s forwards}
.persona-card{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--r2);padding:20px 24px;cursor:pointer;transition:all .2s}
.persona-card:hover{border-color:var(--green);transform:translateY(-2px)}
.persona-icon{font-size:1.6rem;margin-bottom:10px;display:block}
.persona-name{font-family:var(--sans);font-size:1rem;font-weight:600;margin-bottom:4px}
.persona-desc{font-family:var(--sans);font-size:.8rem;color:var(--fg3);line-height:1.4}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* Main App */
#main-app{display:none;height:100vh;flex-direction:column}
#main-app.active{display:flex}
.persona-hero{margin-bottom:28px;padding:24px 28px;background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2)}
.persona-hero h2{font-family:var(--sans);font-size:1.5rem;font-weight:700;margin-bottom:6px}
.persona-hero p{font-family:var(--sans);font-size:.9rem;color:var(--fg2);line-height:1.5}

/* Demo Section */
.demo-section{margin-bottom:28px}
.demo-section label{font-family:var(--mono);font-size:.65rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;display:block;margin-bottom:6px}
textarea,input[type=text],select{width:100%;background:var(--bg2);border:1px solid var(--bg3);color:var(--fg);font-family:var(--mono);font-size:.82rem;padding:12px 14px;border-radius:var(--r);outline:none;transition:border-color .2s;resize:vertical}
textarea:focus,input:focus,select:focus{border-color:var(--green)}
textarea{min-height:90px}
.input-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.btn{font-family:var(--mono);font-size:.75rem;font-weight:600;padding:10px 22px;border:none;border-radius:var(--r);cursor:pointer;transition:all .15s}
.btn-go{background:var(--green);color:var(--bg)}.btn-go:hover{background:var(--green2)}
.btn-ghost{background:transparent;border:1px solid var(--bg4);color:var(--fg3)}.btn-ghost:hover{border-color:var(--fg3);color:var(--fg2)}
.btn-row{display:flex;gap:8px;margin-top:10px}

/* Results */
.results{margin-top:20px}
.loader{display:none;align-items:center;gap:8px;font-family:var(--mono);font-size:.78rem;color:var(--fg3);margin:14px 0}
.loader.on{display:flex}
.spin{width:14px;height:14px;border:2px solid var(--bg4);border-top-color:var(--green);border-radius:50%;animation:sp .5s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}

/* Question Physics Panel */
.question-physics{background:var(--bg2);border:1px solid var(--purple);border-radius:var(--r2);padding:20px;margin-bottom:20px;border-left:4px solid var(--purple)}
.question-physics-header{margin-bottom:16px}
.question-physics-title{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--purple);margin-bottom:4px}
.question-physics-desc{font-size:12px;color:var(--fg3)}
.question-type-badges{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.question-type-badge{display:inline-block;font-family:var(--mono);font-size:10px;font-weight:600;padding:4px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}
.question-type-badge.constraint{background:var(--red2);color:var(--red);border:1px solid var(--red)}
.question-type-badge.authority{background:var(--amber2);color:var(--amber);border:1px solid var(--amber)}
.question-type-badge.framing{background:var(--purple2);color:var(--purple);border:1px solid var(--purple)}
.question-type-badge.info{background:var(--blue2);color:var(--blue);border:1px solid var(--blue)}
.question-risk-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px}
.question-risk-item{text-align:center;padding:12px;background:var(--bg3);border-radius:var(--r)}
.question-risk-label{font-family:var(--mono);font-size:10px;color:var(--fg3);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.question-risk-value{font-family:var(--mono);font-size:16px;font-weight:700}
.question-risk-value.high{color:var(--red)}
.question-risk-value.medium{color:var(--amber)}
.question-risk-value.low{color:var(--green)}

/* Analysis Results */
.analysis-results{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:20px}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:16px}
.card{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:18px 20px;position:relative;overflow:hidden}
.card::after{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.card.g::after{background:var(--green)}.card.r::after{background:var(--red)}.card.a::after{background:var(--amber)}.card.b::after{background:var(--blue)}.card.p::after{background:var(--purple)}.card.c::after{background:var(--cyan)}
.card-label{font-family:var(--mono);font-size:.6rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px}
.card-value{font-family:var(--mono);font-size:1.8rem;font-weight:700;line-height:1}
.card-value.green{color:var(--green)}.card-value.red{color:var(--red)}.card-value.amber{color:var(--amber)}.card-value.blue{color:var(--blue)}.card-value.purple{color:var(--purple)}.card-value.cyan{color:var(--cyan)}
.card-sub{font-family:var(--sans);font-size:.75rem;color:var(--fg3);margin-top:4px}

.insight{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--bg4);border-radius:var(--r2);padding:20px 24px;margin-bottom:16px}
.insight-icon{font-size:1.2rem;margin-bottom:8px;display:block}
.insight h3{font-family:var(--sans);font-size:1.1rem;font-weight:600;margin-bottom:6px}
.insight p{font-family:var(--sans);font-size:.88rem;color:var(--fg2);line-height:1.6}

/* Mobile responsive */
@media(max-width:768px){
  .persona-grid{grid-template-columns:1fr}
  .input-grid{grid-template-columns:1fr}
  .card-grid{grid-template-columns:1fr 1fr}
  .sections-container{padding:16px}
  .question-risk-grid{grid-template-columns:1fr 1fr}
}
@media(max-width:480px){
  .card-grid{grid-template-columns:1fr}
  .question-risk-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div id="persona-gate">
  <div class="gate-logo">ARTIFACT ZERO</div>
  <h1 class="gate-title">Conversational Authority Infrastructure</h1>
  <p class="gate-sub">A deterministic middleware that enforces declared objective geometry and preserves operator-owned salience ordering across human‚ÄìAI interaction.</p>
  <div class="gate-question">Who are you?</div>
  <div class="persona-grid">
    <div class="persona-card" data-persona="explorer"><span class="persona-icon">üîç</span><div class="persona-name">I'm exploring AI tools</div><div class="persona-desc">Show me what this does in plain language</div></div>
    <div class="persona-card" data-persona="executive"><span class="persona-icon">üìä</span><div class="persona-name">I'm a decision-maker</div><div class="persona-desc">Show me cost reduction, risk, ROI</div></div>
    <div class="persona-card" data-persona="developer"><span class="persona-icon">‚öôÔ∏è</span><div class="persona-name">I'm a developer</div><div class="persona-desc">Show me the full diagnostic + API</div></div>
    <div class="persona-card" data-persona="investor"><span class="persona-icon">üöÄ</span><div class="persona-name">I'm an investor</div><div class="persona-desc">Show me defensibility + market position</div></div>
  </div>
</div>

<div id="main-app" class="app-container">
  <div class="app-header">
    <span class="dot"></span><span class="logo">ARTIFACT ZERO</span><span class="ver" id="h-ver">v2.1</span>
  </div>
  
  <div class="app-body">
    <div class="sections-container">
      <div class="persona-hero" id="hero"></div>
      
      <div class="demo-section" id="demo-area"></div>
      
      <div class="loader" id="loader">
        <div class="spin"></div>Running analysis...
      </div>
      
      <div class="results" id="results"></div>
    </div>
  </div>
</div>

<script>
(function(){
const $=id=>document.getElementById(id);

const PERSONAS={
    explorer:{name:'Explorer',title:'See AI instability in real time',desc:'Paste any AI prompt and response below. Artifact Zero will show you exactly where the AI drifted, deflected, or collapsed your constraints.'},
    executive:{name:'Decision-Maker',title:'AI risk & cost at a glance',desc:'Every AI interaction carries hidden risk: constraint collapse, objective drift, unnecessary token spend. Paste a real exchange to see the exposure.'},
    developer:{name:'Developer',title:'Full NTI + Question Physics diagnostic',desc:'Complete audit: failure modes (UDDS/DCE/CCA), tilt taxonomy, NII scoring, plus new Question Physics layer for conversational authority protection.'},
    investor:{name:'Investor',title:'Defensibility & market position',desc:'Artifact Zero enforces conversational topology through closed-set calculus. Not prompt engineering. Not tone filtering. Structural enforcement no competitor offers.'}
};

let currentPersona=null,lastNTI=null,questionPhysicsService=null;

// Detect Question Physics service URL
function getQuestionPhysicsURL() {
    const hostname = window.location.hostname;
    if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return 'http://localhost:5001';
    } else {
        // For production, assume service is on same domain, different port
        return `https://${hostname}:5001`;
    }
}

document.querySelectorAll('.persona-card').forEach(c=>{c.addEventListener('click',()=>activatePersona(c.dataset.persona))});

function activatePersona(key){
    currentPersona=key;
    const p=PERSONAS[key];
    $('persona-gate').style.display='none';
    $('main-app').classList.add('active');
    $('hero').innerHTML='<h2>'+p.title+'</h2><p>'+p.desc+'</p>';
    buildDemoArea(key);
    $('results').innerHTML='';
}

function buildDemoArea(key){
    let html = `
        <label>Paste an AI exchange</label>
        <div class="input-grid" style="margin-bottom:10px">
            <div>
                <label>Prompt / question</label>
                <textarea id="in-prompt" placeholder="What you asked the AI..."></textarea>
            </div>
            <div>
                <label>AI response</label>
                <textarea id="in-answer" placeholder="What the AI said back..."></textarea>
            </div>
        </div>
        <div class="btn-row">
            <button class="btn btn-go" id="btn-run">ANALYZE</button>
            <button class="btn btn-ghost" id="btn-clr">CLEAR</button>
        </div>
    `;
    
    $('demo-area').innerHTML=html;
    $('btn-run').addEventListener('click',runAnalysis);
    $('btn-clr').addEventListener('click',()=>{
        $('in-prompt').value='';
        $('in-answer').value='';
        $('results').innerHTML='';
    });
}

async function runAnalysis(){
    const prompt=($('in-prompt')||{}).value||'';
    const answer=($('in-answer')||{}).value||'';
    if(!prompt&&!answer){alert('Paste text to analyze.');return}
    
    const text = prompt + ' ' + answer;
    
    $('loader').classList.add('on');
    $('results').innerHTML='';
    
    // Call main NTI analysis
    try{
        const r=await fetch('/nti',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt,answer})});
        lastNTI=await r.json();
    }catch(e){
        lastNTI={error:e.message};
    }
    
    // Call Question Physics service (independent)
    let questionPhysics = null;
    try {
        const qpURL = getQuestionPhysicsURL();
        const qpResponse = await fetch(`${qpURL}/analyze`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: text})
        });
        
        if (qpResponse.ok) {
            const qpData = await qpResponse.json();
            questionPhysics = qpData.question_physics;
        }
    } catch(e) {
        console.log('Question Physics service unavailable:', e);
        // Continue without Question Physics
    }
    
    $('loader').classList.remove('on');
    
    // Render results with Question Physics if available
    if (questionPhysics) {
        lastNTI.question_physics = questionPhysics;
    }
    
    renderResults();
}

function renderResults(){
    if(!lastNTI||lastNTI.error){
        $('results').innerHTML='<div class="analysis-results"><div style="color:var(--red)">Error: '+(lastNTI?lastNTI.error:'No response')+'</div></div>';
        return;
    }
    
    const d=lastNTI;
    let html = '';
    
    // Add Question Physics if available
    if (d.question_physics && d.question_physics.question_present) {
        html += renderQuestionPhysics(d.question_physics);
    }
    
    // Basic analysis results
    html += '<div class="analysis-results">';
    html += '<div class="insight"><span class="insight-icon">‚ö°</span><h3>Analysis Complete</h3><p>NTI analysis completed successfully. ';
    
    if (d.question_physics) {
        html += 'Question Physics analysis included. ';
    } else {
        html += 'Question Physics service unavailable. ';
    }
    
    html += 'See detailed results below.</p></div>';
    
    // Simple card display
    const nii = d.nii || {};
    const score = nii.nii_score || 0;
    
    html += '<div class="card-grid">';
    html += `<div class="card g"><div class="card-label">Integrity Score</div><div class="card-value ${score >= 0.75 ? 'green' : 'red'}">${Math.round(score * 100)}%</div></div>`;
    
    const dominance = (d.interaction_matrix || {}).dominance_detected || [];
    html += `<div class="card r"><div class="card-label">Failure Modes</div><div class="card-value ${dominance[0] === 'NONE' ? 'green' : 'red'}">${dominance.join(' + ')}</div></div>`;
    
    html += '</div>';
    html += '</div>';
    
    $('results').innerHTML = html;
}

// Question Physics rendering function
function renderQuestionPhysics(qp) {
    let html = '<div class="question-physics">';
    html += '<div class="question-physics-header">';
    html += '<div class="question-physics-title">QUESTION PHYSICS</div>';
    html += '<div class="question-physics-desc">Structural analysis of question intent - detects authority shift, constraint injection, framing traps</div>';
    html += '</div>';
    
    // Question type badges
    if (qp.question_types && qp.question_types.length > 0) {
        html += '<div class="question-type-badges">';
        for (const type of qp.question_types) {
            const badgeClass = {
                'CONSTRAINT_INJECTION': 'constraint',
                'AUTHORITY_SHIFT': 'authority', 
                'FRAMING_TRAP': 'framing',
                'INFORMATION_EXPANSION': 'info'
            }[type] || 'info';
            
            html += `<div class="question-type-badge ${badgeClass}">${type.replace('_', ' ')}</div>`;
        }
        html += '</div>';
    }
    
    // Risk metrics grid
    html += '<div class="question-risk-grid">';
    
    const riskLevel = qp.structural_risk >= 60 ? 'high' : qp.structural_risk >= 30 ? 'medium' : 'low';
    html += '<div class="question-risk-item">';
    html += '<div class="question-risk-label">Structural Risk</div>';
    html += `<div class="question-risk-value ${riskLevel}">${qp.structural_risk}%</div>`;
    html += '</div>';
    
    if (qp.frame_shift_detected !== undefined) {
        html += '<div class="question-risk-item">';
        html += '<div class="question-risk-label">Frame Shift</div>';
        html += `<div class="question-risk-value ${qp.frame_shift_detected ? 'medium' : 'low'}">${qp.frame_shift_detected ? 'YES' : 'NO'}</div>`;
        html += '</div>';
    }
    
    if (qp.constraint_injection_detected !== undefined) {
        html += '<div class="question-risk-item">';
        html += '<div class="question-risk-label">Constraint Injection</div>';
        html += `<div class="question-risk-value ${qp.constraint_injection_detected ? 'high' : 'low'}">${qp.constraint_injection_detected ? 'YES' : 'NO'}</div>`;
        html += '</div>';
    }
    
    if (qp.authority_shift_detected !== undefined) {
        html += '<div class="question-risk-item">';
        html += '<div class="question-risk-label">Authority Shift</div>';
        html += `<div class="question-risk-value ${qp.authority_shift_detected ? 'medium' : 'low'}">${qp.authority_shift_detected ? 'YES' : 'NO'}</div>`;
        html += '</div>';
    }
    
    html += '</div>';
    html += '</div>';
    
    return html;
}

})();
</script>
</body>
</html>
