<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artifact Zero ‚Äî Conversational Authority Infrastructure</title>
<link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06060a;--bg2:#0c0c14;--bg3:#14141f;--bg4:#1c1c2a;
  --fg:#e8e8f0;--fg2:#9090a8;--fg3:#5a5a72;--fg4:#3a3a4e;
  --green:#00e89c;--green2:#00c080;--green3:rgba(0,232,156,.12);
  --red:#ff4466;--red2:rgba(255,68,102,.12);
  --amber:#ffaa33;--amber2:rgba(255,170,51,.12);
  --blue:#448aff;--blue2:rgba(68,138,255,.12);
  --purple:#9966ff;--purple2:rgba(153,102,255,.12);
  --cyan:#00d4ff;--cyan2:rgba(0,212,255,.12);
  --mono:'Azeret Mono',monospace;--sans:'Outfit',sans-serif;
  --r:8px;--r2:12px;
  /* Enhanced color system */
  --axis1-structural:#448aff;--axis1-light:rgba(68,138,255,0.1);
  --axis2-relational:#ff4466;--axis2-light:rgba(255,68,102,0.1);
  --axis3-economic:#00e89c;--axis3-light:rgba(0,232,156,0.1);
  --assumption:#9966ff;--assumption-light:rgba(153,102,255,0.1);
  --intensifier:#ffaa33;--intensifier-light:rgba(255,170,51,0.1);
  --generalization:#00d4ff;--generalization-light:rgba(0,212,255,0.1);
  --filler:#5a5a72;--filler-light:rgba(90,90,114,0.1);
  --power-word:#ec4899;--power-light:rgba(236,72,153,0.1);
}
html{font-size:15px;overflow-x:hidden}
body{background:var(--bg);color:var(--fg);font-family:var(--sans);min-height:100vh;overflow-x:hidden;scroll-behavior:auto}

/* Fixed App Layout - No Jumping */
.app-container{min-height:100vh;display:flex;flex-direction:column}
.app-header{padding:16px 28px;border-bottom:1px solid var(--bg3);display:flex;align-items:center;gap:12px;background:var(--bg);z-index:100;flex-shrink:0}
.app-header .logo{font-family:var(--mono);font-size:.85rem;font-weight:700;letter-spacing:2px;color:var(--green)}
.app-header .dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.app-header .ver{font-family:var(--mono);font-size:.65rem;color:var(--fg4);padding:2px 6px;border:1px solid var(--bg3);border-radius:3px}
.app-header .persona-label{margin-left:auto;font-family:var(--mono);font-size:.65rem;color:var(--fg3);padding:4px 10px;border:1px solid var(--bg4);border-radius:var(--r);cursor:pointer;transition:all .2s}
.app-header .persona-label:hover{border-color:var(--fg3);color:var(--fg2)}

/* Menu System */
.menu-toggle{position:fixed;top:20px;right:20px;z-index:1000;background:var(--bg2);border:1px solid var(--bg3);border-radius:8px;padding:8px;cursor:pointer;transition:all .2s}
.menu-toggle:hover{border-color:var(--green)}
.menu-icon{width:20px;height:20px;display:flex;flex-direction:column;justify-content:space-between}
.menu-line{height:2px;background:var(--fg);border-radius:1px;transition:all .3s}
.menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:999;opacity:0;visibility:hidden;transition:all .3s}
.menu-overlay.active{opacity:1;visibility:visible}
.menu-panel{position:fixed;top:0;right:0;width:400px;height:100vh;background:var(--bg2);border-left:1px solid var(--bg3);transform:translateX(100%);transition:transform .3s;overflow-y:auto;z-index:1000}
.menu-panel.active{transform:translateX(0)}
.menu-header{padding:24px;border-bottom:1px solid var(--bg3)}
.menu-title{font-family:var(--mono);font-size:16px;font-weight:700;color:var(--green);margin-bottom:4px}
.menu-close{position:absolute;top:20px;right:20px;background:none;border:none;color:var(--fg3);font-size:20px;cursor:pointer;padding:4px}
.menu-section{padding:20px 24px;border-bottom:1px solid var(--bg3)}
.menu-section h3{font-family:var(--mono);font-size:12px;color:var(--green);margin-bottom:12px;text-transform:uppercase;letter-spacing:1px}

/* Color Legend */
.color-legend{display:grid;gap:8px}
.color-item{display:flex;align-items:center;gap:12px;padding:8px;background:var(--bg3);border-radius:6px}
.color-sample{width:16px;height:16px;border-radius:3px}
.color-sample.structural{background:var(--axis1-structural)}
.color-sample.relational{background:var(--axis2-relational)}
.color-sample.economic{background:var(--axis3-economic)}
.color-sample.assumption{background:var(--assumption)}
.color-sample.intensifier{background:var(--intensifier)}
.color-sample.generalization{background:var(--generalization)}
.color-sample.filler{background:var(--filler)}
.color-sample.power{background:var(--power-word)}
.color-label{font-size:13px;font-weight:600}
.color-desc{font-size:11px;color:var(--fg3)}

/* Persona Gate */
#persona-gate{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;position:relative;overflow:hidden}
#persona-gate::before{content:'';position:absolute;width:600px;height:600px;background:radial-gradient(circle,rgba(0,232,156,.06) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}
.gate-logo{font-family:var(--mono);font-size:1rem;font-weight:700;letter-spacing:4px;color:var(--green);margin-bottom:8px;opacity:0;animation:fadeUp .6s .1s forwards}
.gate-title{font-family:var(--sans);font-size:2.4rem;font-weight:700;text-align:center;margin-bottom:8px;opacity:0;animation:fadeUp .6s .2s forwards}
.gate-sub{font-family:var(--sans);font-size:1rem;color:var(--fg2);text-align:center;max-width:520px;line-height:1.5;margin-bottom:48px;opacity:0;animation:fadeUp .6s .3s forwards}
.gate-question{font-family:var(--mono);font-size:.75rem;color:var(--fg3);text-transform:uppercase;letter-spacing:2px;margin-bottom:20px;opacity:0;animation:fadeUp .6s .4s forwards}
.persona-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;max-width:900px;width:100%;opacity:0;animation:fadeUp .6s .5s forwards}
.persona-card{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--r2);padding:20px 24px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.persona-card:hover{border-color:var(--green);transform:translateY(-2px)}
.persona-card:hover .persona-icon{color:var(--green)}
.persona-card:active{transform:translateY(0)}
.persona-icon{font-size:1.6rem;margin-bottom:10px;transition:color .2s;display:block}
.persona-name{font-family:var(--sans);font-size:1rem;font-weight:600;margin-bottom:4px}
.persona-desc{font-family:var(--sans);font-size:.8rem;color:var(--fg3);line-height:1.4}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* Main App Layout - Fixed Container */
#main-app{display:none;height:100vh;flex-direction:column}
#main-app.active{display:flex}
.app-body{flex:1;overflow-y:auto;padding:0}

/* Fixed Sections Container - No Jumping */
.sections-container{max-width:1100px;margin:0 auto;padding:28px}

/* Hero Section */
.persona-hero{margin-bottom:28px;padding:24px 28px;background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2)}
.persona-hero h2{font-family:var(--sans);font-size:1.5rem;font-weight:700;margin-bottom:6px}
.persona-hero p{font-family:var(--sans);font-size:.9rem;color:var(--fg2);line-height:1.5}

/* Demo Section - Always Visible */
.demo-section{margin-bottom:28px}
.demo-section label{font-family:var(--mono);font-size:.65rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;display:block;margin-bottom:6px}
textarea,input[type=text],input[type=number],select{width:100%;background:var(--bg2);border:1px solid var(--bg3);color:var(--fg);font-family:var(--mono);font-size:.82rem;padding:12px 14px;border-radius:var(--r);outline:none;transition:border-color .2s;resize:vertical}
textarea:focus,input:focus,select:focus{border-color:var(--green)}
textarea{min-height:90px}
select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath d='M5 7L1 3h8z' fill='%235a5a72'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}

.input-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.input-grid.three{grid-template-columns:1fr 1fr 1fr}
.input-full{grid-column:1/-1}

.btn{font-family:var(--mono);font-size:.75rem;font-weight:600;padding:10px 22px;border:none;border-radius:var(--r);cursor:pointer;transition:all .15s}
.btn-go{background:var(--green);color:var(--bg)}.btn-go:hover{background:var(--green2)}
.btn-ghost{background:transparent;border:1px solid var(--bg4);color:var(--fg3)}.btn-ghost:hover{border-color:var(--fg3);color:var(--fg2)}
.btn-row{display:flex;gap:8px;margin-top:10px}

.loader{display:none;align-items:center;gap:8px;font-family:var(--mono);font-size:.78rem;color:var(--fg3);margin:14px 0}
.loader.on{display:flex}
.spin{width:14px;height:14px;border:2px solid var(--bg4);border-top-color:var(--green);border-radius:50%;animation:sp .5s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}

/* Progressive Results - Show One at a Time */
.results-container{margin-top:20px}
.result-section{display:none;margin-bottom:20px}
.result-section.active{display:block;animation:fadeInUp .4s ease-out}
@keyframes fadeInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

.result-section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.result-section-title{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--green);text-transform:uppercase;letter-spacing:2px}
.result-section-step{font-family:var(--mono);font-size:12px;color:var(--fg4);background:var(--bg3);padding:4px 8px;border-radius:4px}

/* Next Step Button */
.next-step-btn{background:var(--blue);color:#fff;padding:10px 20px;border:none;border-radius:var(--r);font-family:var(--mono);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px;margin-top:16px}
.next-step-btn:hover{background:#3b74d4;transform:translateY(-1px)}
.next-step-btn:disabled{background:var(--bg4);color:var(--fg4);cursor:not-allowed;transform:none}

/* Analysis Results */
.analysis-results{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:20px}

/* Question Physics Panel */
.question-physics{background:var(--bg2);border:1px solid var(--purple);border-radius:var(--r2);padding:20px;margin-bottom:20px;border-left:4px solid var(--purple)}
.question-physics-header{margin-bottom:16px}
.question-physics-title{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--purple);margin-bottom:4px}
.question-physics-desc{font-size:12px;color:var(--fg3)}
.question-type-badges{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.question-type-badge{display:inline-block;font-family:var(--mono);font-size:10px;font-weight:600;padding:4px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}
.question-type-badge.constraint{background:var(--red2);color:var(--red);border:1px solid var(--red)}
.question-type-badge.authority{background:var(--amber2);color:var(--amber);border:1px solid var(--amber)}
.question-type-badge.framing{background:var(--purple2);color:var(--purple);border:1px solid var(--purple)}
.question-type-badge.repetition{background:var(--cyan2);color:var(--cyan);border:1px solid var(--cyan)}
.question-type-badge.info{background:var(--blue2);color:var(--blue);border:1px solid var(--blue)}
.question-risk-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px}
.question-risk-item{text-align:center;padding:12px;background:var(--bg3);border-radius:var(--r)}
.question-risk-label{font-family:var(--mono);font-size:10px;color:var(--fg3);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.question-risk-value{font-family:var(--mono);font-size:16px;font-weight:700}
.question-risk-value.high{color:var(--red)}
.question-risk-value.medium{color:var(--amber)}
.question-risk-value.low{color:var(--green)}

/* Conversion & Urgency Styles */
.urgency-banner{background:linear-gradient(135deg,rgba(255,68,102,.15),rgba(239,68,68,.1));border:1px solid var(--red);border-radius:8px;padding:20px;text-align:center;margin-bottom:20px;animation:pulse-urgent 2s infinite}
.urgency-number{font-family:var(--mono);font-size:24px;font-weight:700;color:var(--red);margin-bottom:4px}
.urgency-label{font-size:12px;color:var(--fg2);text-transform:uppercase;letter-spacing:1px}
@keyframes pulse-urgent{0%,100%{border-color:var(--red)}50%{border-color:var(--amber)}}

.investor-urgency{border-left:4px solid var(--red) !important}
.investor-action{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:24px;margin:20px 0}
.action-title{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--red);text-align:center;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px}
.action-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
.action-card{background:var(--bg);border:1px solid var(--bg3);border-radius:var(--r);padding:20px;text-align:center;position:relative;overflow:hidden}
.action-card.urgent{border-color:var(--red);background:linear-gradient(135deg,var(--bg),rgba(255,68,102,.05))}
.action-card.premium{border-color:var(--amber);background:linear-gradient(135deg,var(--bg),rgba(255,170,51,.05))}
.action-card.urgent::before{content:'LIMITED';position:absolute;top:8px;right:8px;background:var(--red);color:#fff;font-size:8px;padding:2px 6px;border-radius:3px;font-weight:700}
.action-amount{font-family:var(--mono);font-size:28px;font-weight:700;color:var(--green);margin-bottom:8px}
.action-label{font-family:var(--mono);font-size:11px;color:var(--fg3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.action-desc{font-size:13px;color:var(--fg2);line-height:1.4;margin-bottom:16px}
.action-btn{width:100%;padding:12px 20px;border:none;border-radius:var(--r);font-family:var(--sans);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}
.action-btn.red{background:var(--red);color:#fff}
.action-btn.red:hover{background:#dc2626;transform:translateY(-1px)}
.action-btn.green{background:var(--green);color:#000}
.action-btn.green:hover{background:#16a34a;transform:translateY(-1px)}
.action-btn.premium{background:linear-gradient(135deg,var(--amber),var(--green));color:#000}
.action-btn.premium:hover{transform:translateY(-1px);box-shadow:0 8px 25px rgba(255,170,51,.3)}

.savings-calculator{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:20px;margin:20px 0}
.calc-title{font-family:var(--mono);font-size:14px;color:var(--green);margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
.calc-row{display:grid;grid-template-columns:200px 1fr 100px;gap:12px;align-items:center;margin-bottom:12px}
.calc-label{font-size:13px;color:var(--fg2)}
.calc-input{background:var(--bg);border:1px solid var(--bg3);color:var(--fg);padding:8px 12px;border-radius:4px;font-family:var(--mono);font-size:13px}
.calc-result{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--green);text-align:right}
.savings-projection{background:linear-gradient(135deg,rgba(0,232,156,.08),rgba(0,212,255,.06));border:1px solid rgba(0,232,156,.2);border-radius:var(--r);padding:16px;margin-top:16px;text-align:center}
.projection-amount{font-family:var(--mono);font-size:32px;font-weight:700;color:var(--green)}
.projection-timeline{font-size:12px;color:var(--fg2);margin-top:4px}

/* Card System */
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:16px}
.card{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:18px 20px;position:relative;overflow:hidden}
.card::after{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.card.g::after{background:var(--green)}.card.r::after{background:var(--red)}.card.a::after{background:var(--amber)}.card.b::after{background:var(--blue)}.card.p::after{background:var(--purple)}.card.c::after{background:var(--cyan)}
.card-label{font-family:var(--mono);font-size:.6rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px}
.card-value{font-family:var(--mono);font-size:1.8rem;font-weight:700;line-height:1}
.card-value.green{color:var(--green)}.card-value.red{color:var(--red)}.card-value.amber{color:var(--amber)}.card-value.blue{color:var(--blue)}.card-value.purple{color:var(--purple)}.card-value.cyan{color:var(--cyan)}
.card-sub{font-family:var(--sans);font-size:.75rem;color:var(--fg3);margin-top:4px}

.detail-block{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:18px 20px;margin-bottom:12px}
.detail-title{font-family:var(--mono);font-size:.65rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px}
.detail-body{font-family:var(--sans);font-size:.85rem;color:var(--fg2);line-height:1.6}

.insight{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--bg4);border-radius:var(--r2);padding:20px 24px;margin-bottom:16px}
.insight-icon{font-size:1.2rem;margin-bottom:8px;display:block}
.insight h3{font-family:var(--sans);font-size:1.1rem;font-weight:600;margin-bottom:6px}
.insight p{font-family:var(--sans);font-size:.88rem;color:var(--fg2);line-height:1.6}

.json-toggle{font-family:var(--mono);font-size:.65rem;color:var(--fg4);cursor:pointer;margin-top:12px;user-select:none}
.json-toggle:hover{color:var(--fg3)}
.json-raw{display:none;margin-top:8px;background:var(--bg);border:1px solid var(--bg3);border-radius:var(--r);padding:12px;max-height:350px;overflow:auto}
.json-raw.open{display:block}
.json-raw pre{font-family:var(--mono);font-size:.7rem;color:var(--fg3);white-space:pre-wrap;word-break:break-all}

/* Email Enhancement Tool - Separate Context */
.email-tool{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:20px;margin-top:24px}
.email-tool-header{margin-bottom:20px}
.email-tool-title{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--blue);margin-bottom:4px}
.email-tool-desc{font-size:12px;color:var(--fg3)}
.email-tool-input{margin-bottom:16px}
.email-tool-input textarea{min-height:80px}
.email-tool-controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-bottom:20px}
.email-control-group{display:flex;gap:8px}
.email-control-btn{padding:6px 12px;border:1px solid var(--bg3);background:var(--bg3);color:var(--fg3);font-size:11px;font-weight:600;border-radius:4px;cursor:pointer;transition:all .2s;font-family:var(--sans)}
.email-control-btn:hover{border-color:var(--blue);color:var(--fg)}
.email-control-btn.active{background:var(--blue);color:#fff;border-color:var(--blue)}
.email-tool-output{background:var(--bg);border:1px solid var(--bg3);border-radius:6px;padding:16px;min-height:80px;font-family:var(--sans);line-height:1.6;position:relative}

/* Interactive Demo Styles */
.interactive-demo-section{margin-top:32px;padding:24px;background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2)}
.demo-selector{text-align:center;margin-bottom:24px}
.demo-selector h3{font-family:var(--mono);font-size:18px;color:var(--green);margin-bottom:8px}
.demo-selector p{font-size:14px;color:var(--fg2);margin-bottom:20px}
.demo-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;max-width:600px;margin:0 auto}
.demo-select-btn{padding:12px 16px;background:var(--bg3);border:1px solid var(--bg4);color:var(--fg);border-radius:var(--r);font-family:var(--sans);font-size:14px;cursor:pointer;transition:all .2s}
.demo-select-btn:hover{border-color:var(--green);background:var(--bg4);transform:translateY(-1px)}

/* Mobile responsive */
@media(max-width:768px){
  .menu-panel{width:100%;max-width:400px}
  .persona-grid{grid-template-columns:1fr}
  .gate-title{font-size:1.8rem}
  .input-grid,.input-grid.three{grid-template-columns:1fr}
  .card-grid{grid-template-columns:1fr 1fr}
  .sections-container{padding:16px}
  .action-grid{grid-template-columns:1fr}
  .calc-row{grid-template-columns:1fr}
  .calc-result{text-align:left;margin-top:4px}
  .demo-buttons{grid-template-columns:1fr}
  .email-tool-controls{grid-template-columns:1fr}
  .question-risk-grid{grid-template-columns:1fr 1fr}
  .question-type-badges{flex-direction:column;align-items:flex-start}
}
@media(max-width:480px){
  .card-grid{grid-template-columns:1fr}
  .question-risk-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- Menu Toggle -->
<div class="menu-toggle" onclick="toggleMenu()">
  <div class="menu-icon">
    <div class="menu-line"></div>
    <div class="menu-line"></div>
    <div class="menu-line"></div>
  </div>
</div>

<!-- Menu Overlay -->
<div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

<!-- Menu Panel -->
<div class="menu-panel" id="menuPanel">
  <div class="menu-header">
    <div class="menu-title">NTI GUIDE</div>
    <button class="menu-close" onclick="closeMenu()">&times;</button>
  </div>
  
  <div class="menu-section">
    <h3>Color System</h3>
    <div class="color-legend">
      <div class="color-item">
        <div class="color-sample structural"></div>
        <div>
          <div class="color-label">Structural (Axis 1)</div>
          <div class="color-desc">Objective drift, constraint collapse</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample relational"></div>
        <div>
          <div class="color-label">Relational (Axis 2)</div>
          <div class="color-desc">Conversational friction, dominance</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample economic"></div>
        <div>
          <div class="color-label">Economic (Axis 3)</div>
          <div class="color-desc">Token efficiency, cost optimization</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample assumption"></div>
        <div>
          <div class="color-label">Assumptions</div>
          <div class="color-desc">Unverified claims, presumptions</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample intensifier"></div>
        <div>
          <div class="color-label">Emotional Intensifiers</div>
          <div class="color-desc">Urgency, pressure, amplification</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample generalization"></div>
        <div>
          <div class="color-label">Generalizations</div>
          <div class="color-desc">Overly broad statements</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample power"></div>
        <div>
          <div class="color-label">Power Words</div>
          <div class="color-desc">High-impact semantic operators</div>
        </div>
      </div>
      <div class="color-item">
        <div class="color-sample filler"></div>
        <div>
          <div class="color-label">Filler</div>
          <div class="color-desc">Low-value connector words</div>
        </div>
      </div>
    </div>
  </div>

  <div class="menu-section">
    <h3>Question Physics</h3>
    <div style="font-size:13px;line-height:1.6">
      <p><strong>What is Question Physics?</strong><br>
      Structural analysis of question intent - detects when questions are used for authority shift, constraint injection, or framing traps.</p>
      <p style="margin-top:12px"><strong>Question Types:</strong><br>
      ‚Ä¢ Constraint Injection: Implies missing requirements<br>
      ‚Ä¢ Authority Shift: Moves burden of proof<br>
      ‚Ä¢ Framing Trap: Positions into defensive frame<br>
      ‚Ä¢ Repetition Pressure: Same question multiple ways</p>
    </div>
  </div>

  <div class="menu-section">
    <h3>FAQ</h3>
    <div style="font-size:13px;line-height:1.6">
      <p><strong>What is NTI?</strong><br>
      No-Tilt Interface - deterministic middleware that prevents AI from drifting from your constraints.</p>
      <p style="margin-top:12px"><strong>How does color-coding work?</strong><br>
      Each color represents a different type of structural or linguistic pattern. Click highlighted text to see explanations.</p>
      <p style="margin-top:12px"><strong>What are the axes?</strong><br>
      Axis 1: Structural integrity (objective drift)<br>
      Axis 2: Relational friction (conversational damage)<br>
      Axis 3: Economic efficiency (token optimization)</p>
      <p style="margin-top:12px"><strong>Is this AI-powered?</strong><br>
      No. NTI uses deterministic rules. Zero AI inference cost.</p>
    </div>
  </div>
</div>

<div id="persona-gate">
  <div class="gate-logo">ARTIFACT ZERO</div>
  <h1 class="gate-title">Conversational Authority Infrastructure</h1>
  <p class="gate-sub">A deterministic middleware that enforces declared objective geometry and preserves operator-owned salience ordering across human‚ÄìAI interaction.</p>
  <div class="gate-question">Who are you?</div>
  <div class="persona-grid">
    <div class="persona-card" data-persona="explorer"><span class="persona-icon">üîç</span><div class="persona-name">I'm exploring AI tools</div><div class="persona-desc">Show me what this does in plain language</div></div>
    <div class="persona-card" data-persona="executive"><span class="persona-icon">üìä</span><div class="persona-name">I'm a decision-maker</div><div class="persona-desc">Show me cost reduction, risk, ROI</div></div>
    <div class="persona-card" data-persona="developer"><span class="persona-icon">‚öôÔ∏è</span><div class="persona-name">I'm a developer</div><div class="persona-desc">Show me the full diagnostic + API</div></div>
    <div class="persona-card" data-persona="cfo"><span class="persona-icon">üí∞</span><div class="persona-name">I'm analyzing AI spend</div><div class="persona-desc">Show me token economics + savings</div></div>
    <div class="persona-card" data-persona="investor"><span class="persona-icon">üöÄ</span><div class="persona-name">I'm an investor</div><div class="persona-desc">Show me defensibility + market position</div></div>
  </div>
</div>

<div id="main-app" class="app-container">
  <div class="app-header">
    <span class="dot"></span><span class="logo">ARTIFACT ZERO</span><span class="ver" id="h-ver">v2.1</span>
    <span class="persona-label" id="h-persona" title="Click to switch view">-</span>
  </div>
  
  <div class="app-body">
    <div class="sections-container">
      <div class="persona-hero" id="hero"></div>
      
      <div class="demo-section" id="demo-area"></div>
      
      <div class="loader" id="loader">
        <div class="spin"></div>Running analysis...
      </div>
      
      <!-- Progressive Results Container -->
      <div class="results-container" id="resultsContainer">
        
        <!-- Step 1: Analysis Results -->
        <div class="result-section" id="analysisSection">
          <div class="result-section-header">
            <div class="result-section-title">Analysis Complete</div>
            <div class="result-section-step">Step 1 of 4</div>
          </div>
          <div class="analysis-results" id="analysisResults"></div>
          <button class="next-step-btn" onclick="showNextSection('toolsSection')">
            Show Enhancement Tools ‚Üí
          </button>
        </div>

        <!-- Step 2: Email Enhancement Tool -->
        <div class="result-section" id="toolsSection">
          <div class="result-section-header">
            <div class="result-section-title">Email Enhancement Tool</div>
            <div class="result-section-step">Step 2 of 4</div>
          </div>
          <div class="email-tool">
            <div class="email-tool-header">
              <div class="email-tool-title">TRANSFORM YOUR EMAILS</div>
              <div class="email-tool-desc">Write an email draft, then use controls to see different versions</div>
            </div>
            <div class="email-tool-input">
              <label>Your Email Draft:</label>
              <textarea id="emailInput" placeholder="Type your email here..."></textarea>
            </div>
            <div class="email-tool-controls">
              <div>
                <label style="font-size:11px;color:var(--fg3);margin-bottom:8px;display:block;">APPROACH</label>
                <div class="email-control-group">
                  <div class="email-control-btn active" data-axis="approach" data-value="sales">Sales</div>
                  <div class="email-control-btn" data-axis="approach" data-value="definitive">Definitive</div>
                </div>
              </div>
              <div>
                <label style="font-size:11px;color:var(--fg3);margin-bottom:8px;display:block;">URGENCY</label>
                <div class="email-control-group">
                  <div class="email-control-btn active" data-axis="urgency" data-value="measured">Measured</div>
                  <div class="email-control-btn" data-axis="urgency" data-value="urgent">Urgent</div>
                </div>
              </div>
              <div>
                <label style="font-size:11px;color:var(--fg3);margin-bottom:8px;display:block;">TONE</label>
                <div class="email-control-group">
                  <div class="email-control-btn active" data-axis="tone" data-value="diplomatic">Diplomatic</div>
                  <div class="email-control-btn" data-axis="tone" data-value="direct">Direct</div>
                </div>
              </div>
            </div>
            <div class="email-tool-output" id="emailOutput">
              Type an email above and use the controls to see it transform...
            </div>
          </div>
          <button class="next-step-btn" onclick="showNextSection('aiSection')">
            Try AI Comparison ‚Üí
          </button>
        </div>

        <!-- Step 3: Raw Input vs NTI Analysis -->
        <div class="result-section" id="aiSection">
          <div class="result-section-header">
            <div class="result-section-title">Raw Input vs NTI Analysis</div>
            <div class="result-section-step">Step 3 of 4</div>
          </div>
          <div class="ai-comparison-tool">
            <div style="padding:20px;background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2)">
              <div style="margin-bottom:16px">
                <div style="font-family:var(--mono);font-size:14px;color:var(--green);margin-bottom:8px">COMPARE RAW INPUT VS STRUCTURAL ANALYSIS</div>
                <div style="font-size:12px;color:var(--fg3)">Type any text to see how NTI analyzes its structural integrity</div>
              </div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                <div style="background:var(--bg);border:1px solid var(--bg3);border-radius:6px;padding:16px">
                  <div style="font-family:var(--mono);font-size:12px;color:var(--fg3);margin-bottom:12px;text-align:center">RAW INPUT (What You Type)</div>
                  <input type="text" id="rawAIInput" placeholder="Type any question or text..." style="width:100%;background:transparent;border:1px solid var(--bg3);color:var(--fg);padding:10px;border-radius:4px;font-size:13px;margin-bottom:10px">
                  <button onclick="queryRawAI()" style="width:100%;padding:8px;background:var(--amber);color:var(--bg);border:none;border-radius:4px;font-size:12px;cursor:pointer;margin-bottom:8px">Show Raw Input</button>
                  <div id="rawAIResponse" style="min-height:100px;background:var(--bg3);border-radius:4px;padding:12px;font-size:13px;line-height:1.5;border:1px solid var(--bg4)">Your input will appear here...</div>
                </div>
                <div style="background:var(--bg);border:1px solid var(--bg3);border-radius:6px;padding:16px">
                  <div style="font-family:var(--mono);font-size:12px;color:var(--fg3);margin-bottom:12px;text-align:center">NTI STRUCTURAL ANALYSIS</div>
                  <input type="text" id="ntiAIInput" placeholder="Same text..." style="width:100%;background:transparent;border:1px solid var(--bg3);color:var(--fg);padding:10px;border-radius:4px;font-size:13px;margin-bottom:10px">
                  <button onclick="queryNTIAI()" style="width:100%;padding:8px;background:var(--green);color:var(--bg);border:none;border-radius:4px;font-size:12px;cursor:pointer;margin-bottom:8px">Run NTI Analysis</button>
                  <div id="ntiAIResponse" style="min-height:100px;background:var(--bg3);border-radius:4px;padding:12px;font-size:13px;line-height:1.5;border:1px solid var(--bg4)">Analysis results will appear here...</div>
                </div>
              </div>
            </div>
          </div>
          <button class="next-step-btn" onclick="showNextSection('demosSection')">
            Try Interactive Demos ‚Üí
          </button>
        </div>

        <!-- Step 4: Interactive Demos -->
        <div class="result-section" id="demosSection">
          <div class="result-section-header">
            <div class="result-section-title">Interactive Demos</div>
            <div class="result-section-step">Step 4 of 4</div>
          </div>
          <div class="interactive-demo-section">
            <div class="demo-selector" id="demoSelector">
              <h3>Experience Problem ‚Üí Solution Flow</h3>
              <p>See exactly what NTI fixes in real-time with guided scenarios</p>
              <div class="demo-buttons">
                <button class="demo-select-btn" onclick="startDemo('email_response')">
                  üìß Fix Email Response
                </button>
                <button class="demo-select-btn" onclick="startDemo('customer_support')">
                  üö® Handle Customer Crisis  
                </button>
                <button class="demo-select-btn" onclick="startDemo('project_update')">
                  üìä Project Status Update
                </button>
              </div>
            </div>
            <div id="interactiveDemoContainer"></div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
(function(){
const $=id=>document.getElementById(id);

const PERSONAS={
    explorer:{name:'Explorer',title:'See AI instability in real time',desc:'Paste any AI prompt and response below. Artifact Zero will show you exactly where the AI drifted, deflected, or collapsed your constraints ‚Äî without using any AI itself.'},
    executive:{name:'Decision-Maker',title:'AI risk & cost at a glance',desc:'Every AI interaction carries hidden risk: constraint collapse, objective drift, unnecessary token spend. Paste a real exchange to see the exposure.'},
    developer:{name:'Developer',title:'Full NTI + Physics diagnostic',desc:'Complete audit: failure modes (UDDS/DCE/CCA), tilt taxonomy, NII scoring, plus the new conversational physics layer ‚Äî transform legality, abstraction tracking, drift detection.'},
    cfo:{name:'AI Spend Analyst',title:'Token economics & invocation savings',desc:'See how many tokens an AI exchange actually needed vs. what was burned. Validated 63‚Äì65% cost reduction across GPT-4.1, Claude Opus 4.6, Gemini 2.5 Pro. Rule-based ‚Äî zero inference cost.'},
    investor:{name:'Investor',title:'Defensibility & market position',desc:'Artifact Zero enforces conversational topology through closed-set calculus. Not prompt engineering. Not tone filtering. Structural enforcement no competitor offers.'}
};

let currentPersona=null,lastNTI=null,lastPhysics=null,originalText='';
let currentEmailState={approach:'sales',urgency:'measured',tone:'diplomatic'};

fetch('/health').then(r=>r.json()).then(d=>{$('h-ver').textContent=d.version||'v2.1'}).catch(()=>{});

// Question Physics Service URL Detection
function getQuestionPhysicsURL() {
    const hostname = window.location.hostname;
    if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return 'http://localhost:5001';
    } else {
        // For production - adjust this to your Question Physics service URL
        return `https://${hostname}:5001`;
    }
}

// Menu functions
function toggleMenu(){
    const overlay=$('menuOverlay');
    const panel=$('menuPanel');
    overlay.classList.toggle('active');
    panel.classList.toggle('active');
}

function closeMenu(){
    $('menuOverlay').classList.remove('active');
    $('menuPanel').classList.remove('active');
}

document.querySelectorAll('.persona-card').forEach(c=>{c.addEventListener('click',()=>activatePersona(c.dataset.persona))});
$('h-persona').addEventListener('click',()=>{$('persona-gate').style.display='flex';$('main-app').classList.remove('active');resetResults()});

function activatePersona(key){
    currentPersona=key;
    const p=PERSONAS[key];
    $('persona-gate').style.display='none';
    $('main-app').classList.add('active');
    $('h-persona').textContent=p.name.toUpperCase();
    $('hero').innerHTML='<h2>'+p.title+'</h2><p>'+p.desc+'</p>';
    buildDemoArea(key);
    resetResults();
}

function resetResults(){
    // Hide all result sections
    document.querySelectorAll('.result-section').forEach(section => {
        section.classList.remove('active');
    });
    // Clear content
    $('analysisResults').innerHTML='';
}

function buildDemoArea(key){
    let html='';
    if(key==='developer'){
        html+=`<label>Prompt</label><div class="input-grid" style="margin-bottom:10px"><textarea id="in-prompt" placeholder="Enter the prompt / human input..."></textarea><textarea id="in-answer" placeholder="Enter the AI response..."></textarea></div><div class="input-grid three" style="margin-bottom:10px"><div><label>Objective Type (Physics)</label><select id="in-obj"><option value="">Skip physics</option><option value="RESOLVE">RESOLVE</option><option value="EXPLORE">EXPLORE</option><option value="STRUCTURE">STRUCTURE</option><option value="EXECUTE">EXECUTE</option><option value="DIAGNOSE">DIAGNOSE</option><option value="ALIGN">ALIGN</option></select></div><div><label>Prev Abstraction (0-5)</label><input type="text" id="in-abs" value="0"></div><div><label>Stagnant Turns</label><input type="text" id="in-stag" value="0"></div></div><div class="btn-row"><button class="btn btn-go" id="btn-run">RUN FULL AUDIT</button><button class="btn btn-ghost" id="btn-clr">CLEAR</button></div>`;
    }else{
        html+=`<label>Paste an AI exchange</label><div class="input-grid" style="margin-bottom:10px"><div><label>Prompt / question</label><textarea id="in-prompt" placeholder="What you asked the AI..."></textarea></div><div><label>AI response</label><textarea id="in-answer" placeholder="What the AI said back..."></textarea></div></div><div class="btn-row"><button class="btn btn-go" id="btn-run">ANALYZE</button><button class="btn btn-ghost" id="btn-clr">CLEAR</button></div>`;
    }
    $('demo-area').innerHTML=html;
    $('btn-run').addEventListener('click',runAnalysis);
    $('btn-clr').addEventListener('click',()=>{
        if($('in-prompt'))$('in-prompt').value='';
        if($('in-answer'))$('in-answer').value='';
        resetResults();
    });
}

async function runAnalysis(){
    const prompt=($('in-prompt')||{}).value||'';
    const answer=($('in-answer')||{}).value||'';
    if(!prompt&&!answer){alert('Paste text to analyze.');return}
    
    originalText=prompt+' '+answer;
    
    $('loader').classList.add('on');
    resetResults();
    
    // Call main NTI analysis
    try{
        const r=await fetch('/nti',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt,answer})});
        lastNTI=await r.json();
    }catch(e){
        lastNTI={error:e.message};
    }
    
    // Call Question Physics service (SURGICAL CHANGE - now calls standalone service)
    try {
        const qpURL = getQuestionPhysicsURL();
        const qpResponse = await fetch(`${qpURL}/analyze`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: originalText})
        });
        
        if (qpResponse.ok) {
            const qpData = await qpResponse.json();
            if (lastNTI && qpData.question_physics) {
                lastNTI.question_physics = qpData.question_physics;
            }
        }
    } catch(e) {
        console.log('Question Physics service unavailable:', e);
        // Continue without Question Physics - graceful fallback
    }
    
    lastPhysics=null;
    const objEl=$('in-obj');
    if(objEl&&objEl.value){
        try{
            const r=await fetch('/physics',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:prompt+'\n'+answer,objective_type:objEl.value,previous_abstraction_level:parseInt(($('in-abs')||{}).value)||0,consecutive_stagnant_turns:parseInt(($('in-stag')||{}).value)||0})});
            lastPhysics=await r.json();
        }catch(e){
            lastPhysics={error:e.message};
        }
    }
    
    $('loader').classList.remove('on');
    showAnalysisResults();
}

function showAnalysisResults(){
    if(!lastNTI||lastNTI.error){
        $('analysisResults').innerHTML='<div class="detail-block"><div class="detail-title">Error</div><div class="detail-body" style="color:var(--red)">'+(lastNTI?lastNTI.error:'No response')+'</div></div>';
        $('analysisSection').classList.add('active');
        return;
    }
    
    const d=lastNTI,nii=d.nii||{},dominance=(d.interaction_matrix||{}).dominance_detected||[],tilt=d.tilt_taxonomy||[],udds=(d.parent_failure_modes||{}).UDDS||{},dce=(d.parent_failure_modes||{}).DCE||{},cca=(d.parent_failure_modes||{}).CCA||{},drift_score=((d.layers||{}).L3_objective_integrity||{}).drift_score||0,latency=(d.telemetry||{}).latency_ms;
    
    let html = '';
    ({
        explorer:()=>{html=renderExplorer(d,nii,dominance,tilt,drift_score,udds,dce,cca)},
        executive:()=>{html=renderExecutive(d,nii,dominance,tilt,drift_score,udds,dce,cca,latency)},
        developer:()=>{html=renderDeveloper(d,nii,dominance,tilt,drift_score,udds,dce,cca,latency)},
        cfo:()=>{html=renderCFO(d,nii,dominance,tilt,drift_score,latency)},
        investor:()=>{html=renderInvestor(d,nii,dominance,tilt,drift_score,udds,dce,cca)}
    })[currentPersona]();
    
    $('analysisResults').innerHTML=html;
    $('analysisSection').classList.add('active');
    
    // Initialize email tool with original text
    $('emailInput').value = originalText;
    transformEmail();
}

// Question Physics Display Function (unchanged)
function renderQuestionPhysics(qp) {
    if (!qp || !qp.question_present) return '';
    
    let html = '<div class="question-physics">';
    html += '<div class="question-physics-header">';
    html += '<div class="question-physics-title">QUESTION PHYSICS</div>';
    html += '<div class="question-physics-desc">Structural analysis of question intent - no accusations, just patterns</div>';
    html += '</div>';
    
    // Question type badges
    if (qp.question_types && qp.question_types.length > 0) {
        html += '<div class="question-type-badges">';
        for (const type of qp.question_types) {
            const badgeClass = {
                'CONSTRAINT_INJECTION': 'constraint',
                'AUTHORITY_SHIFT': 'authority', 
                'FRAMING_TRAP': 'framing',
                'REPETITION_PRESSURE': 'repetition',
                'INFORMATION_EXPANSION': 'info'
            }[type] || 'info';
            
            html += `<div class="question-type-badge ${badgeClass}">${type.replace('_', ' ')}</div>`;
        }
        html += '</div>';
    }
    
    // Risk metrics grid
    html += '<div class="question-risk-grid">';
    
    const riskLevel = qp.structural_risk >= 60 ? 'high' : qp.structural_risk >= 30 ? 'medium' : 'low';
    html += '<div class="question-risk-item">';
    html += '<div class="question-risk-label">Structural Risk</div>';
    html += `<div class="question-risk-value ${riskLevel}">${qp.structural_risk}%</div>`;
    html += '</div>';
    
    if (qp.frame_shift_detected !== undefined) {
        html += '<div class="question-risk-item">';
        html += '<div class="question-risk-label">Frame Shift</div>';
        html += `<div class="question-risk-value ${qp.frame_shift_detected ? 'medium' : 'low'}">${qp.frame_shift_detected ? 'YES' : 'NO'}</div>`;
        html += '</div>';
    }
    
    if (qp.constraint_injection_detected !== undefined) {
        html += '<div class="question-risk-item">';
        html += '<div class="question-risk-label">Constraint Injection</div>';
        html += `<div class="question-risk-value ${qp.constraint_injection_detected ? 'high' : 'low'}">${qp.constraint_injection_detected ? 'YES' : 'NO'}</div>`;
        html += '</div>';
    }
    
    if (qp.authority_shift_detected !== undefined) {
        html += '<div class="question-risk-item">';
        html += '<div class="question-risk-label">Authority Shift</div>';
        html += `<div class="question-risk-value ${qp.authority_shift_detected ? 'medium' : 'low'}">${qp.authority_shift_detected ? 'YES' : 'NO'}</div>`;
        html += '</div>';
    }
    
    html += '</div>';
    html += '</div>';
    
    return html;
}

// Progressive section revealing - NO PAGE JUMPING
function showNextSection(sectionId) {
    const section = $(sectionId);
    if (section) {
        section.classList.add('active');
        // NO scrollIntoView - keep user exactly where they are
    }
}

// Email Enhancement Tool
function setupEmailTool() {
    document.querySelectorAll('.email-control-btn').forEach(btn=>{
        btn.addEventListener('click',function(){
            const axis=this.dataset.axis;
            const value=this.dataset.value;
            
            document.querySelectorAll(`.email-control-btn[data-axis="${axis}"]`).forEach(b=>b.classList.remove('active'));
            this.classList.add('active');
            
            currentEmailState[axis]=value;
            transformEmail();
        });
    });
    
    $('emailInput').addEventListener('input', transformEmail);
}

function transformEmail(){
    const emailText = $('emailInput').value.trim();
    if (!emailText) {
        $('emailOutput').textContent = 'Type an email above and use the controls to see it transform...';
        return;
    }
    
    let transformed = emailText;
    const state = currentEmailState;
    
    if(state.approach==='sales'){
        transformed=transformed.replace(/\b(problem|issue|error)\b/gi,'opportunity');
        transformed=transformed.replace(/\b(fix|solve)\b/gi,'optimize');
    }else{
        transformed=transformed.replace(/\bopportunity\b/gi,'problem');
        transformed=transformed.replace(/\boptimize\b/gi,'fix');
    }
    
    if(state.urgency==='urgent'){
        transformed=transformed.replace(/\b(later|eventually|sometime)\b/gi,'immediately');
        if(!transformed.startsWith('URGENT:')){
            transformed='URGENT: '+transformed;
        }
    }else{
        transformed=transformed.replace(/^URGENT: /,'');
        transformed=transformed.replace(/\bimmediately\b/gi,'when appropriate');
    }
    
    if(state.tone==='direct'){
        transformed=transformed.replace(/\b(please|kindly|perhaps|I believe)\b/gi,'');
        transformed=transformed.replace(/\s+/g,' ').trim();
    }else{
        if(!transformed.startsWith('I believe')){
            transformed='I believe '+transformed;
        }
    }
    
    $('emailOutput').textContent = transformed;
}

// AI Comparison Functions - Fixed to use existing /nti endpoint
async function queryRawAI(){
    const input = $('rawAIInput').value.trim();
    if (!input) return;
    
    $('rawAIResponse').textContent = 'Processing...';
    
    // Simply show the raw input as "baseline"
    setTimeout(() => {
        $('rawAIResponse').textContent = input;
    }, 500);
}

async function queryNTIAI(){
    const input = $('ntiAIInput').value.trim();
    if (!input) return;
    
    $('ntiAIResponse').textContent = 'Processing with NTI...';
    
    try {
        // Call existing /nti endpoint
        const res = await fetch('/nti', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: input})
        });
        
        const data = await res.json();
        
        if (data.error) {
            $('ntiAIResponse').textContent = 'Error: ' + data.error;
            return;
        }
        
        // Create a summary of NTI analysis
        const nii = data.nii || {};
        const score = Math.round((nii.nii_score || 0) * 100);
        const dominance = (data.interaction_matrix || {}).dominance_detected || [];
        const tilt = data.tilt_taxonomy || [];
        
        let summary = `NTI Analysis Results:\n\n`;
        summary += `‚Ä¢ Integrity Score: ${score}%\n`;
        summary += `‚Ä¢ Structural Issues: ${tilt.length} detected\n`;
        summary += `‚Ä¢ Failure Modes: ${dominance.join(', ') || 'None'}\n`;
        
        if (data.question_physics && data.question_physics.question_present) {
            const qp = data.question_physics;
            summary += `\nQuestion Physics:\n`;
            summary += `‚Ä¢ Type: ${qp.question_types.join(', ')}\n`;
            summary += `‚Ä¢ Structural Risk: ${qp.structural_risk}%\n`;
        }
        
        if (score < 75) {
            summary += `\nRecommendation: This input shows structural instability. Consider rephrasing with clearer constraints.`;
        } else {
            summary += `\nRecommendation: Input structure is stable and well-formed.`;
        }
        
        $('ntiAIResponse').textContent = summary;
        
    } catch(err) {
        $('ntiAIResponse').textContent = 'Connection error: ' + err.message;
    }
}

// Sync inputs between AI comparison columns
document.addEventListener('DOMContentLoaded',function(){
    $('rawAIInput').addEventListener('input',function(){
        $('ntiAIInput').value=this.value;
    });
    
    $('ntiAIInput').addEventListener('input',function(){
        $('rawAIInput').value=this.value;
    });
    
    setupEmailTool();
});

// Interactive Demos (simplified for now)
function startDemo(demoType) {
    $('demoSelector').style.display = 'none';
    $('interactiveDemoContainer').innerHTML = '<div style="padding:40px;text-align:center;color:var(--fg2);">Interactive demos coming soon...</div>';
}

// Render functions (updated to include Question Physics)
function renderInvestor(d,nii,dominance,tilt,drift,udds,dce,cca){
    let h='',score=nii.nii_score||0;
    
    // Add Question Physics if available
    if (d.question_physics) {
        h += renderQuestionPhysics(d.question_physics);
    }
    
    h+='<div class="urgency-banner"><div class="urgency-number">LIVE DEMO</div><div class="urgency-label">You just experienced the product working in real-time ¬∑ This is not a mockup</div></div>';
    h+='<div class="insight investor-urgency"><span class="insight-icon">üö®</span><h3>What you just witnessed</h3><p>This analysis ran in <strong>'+(d.telemetry?.latency_ms||'<100')+'ms</strong> using zero AI calls. Pure deterministic logic caught structural failures that would cost thousands in rework tokens. <strong>Every enterprise with >$50K/month AI spend needs this.</strong> We\'re raising $2.5M to lock in first-mover advantage before competitors figure out conversational physics.</p></div>';
    h+='<div class="card-grid">';
    h+=mk('Your Demo',Math.round(score*100)+'%',score>=.75?'green':'red','g','Live integrity analysis');
    h+=mk('Market Gap','MASSIVE','green','g','No one else does this');
    h+=mk('Defensibility','PATENT-READY','green','g','Conversational physics IP');
    h+=mk('Revenue Model','VALIDATED','green','g','63-65% cost reduction proven');
    h+='</div>';
    h+='<div class="investor-action"><div class="action-title">This Round Closes March 31st</div><div class="action-grid"><div class="action-card urgent"><div class="action-amount">$25K</div><div class="action-label">DEMO + DUE DILIGENCE</div><div class="action-desc">1hr technical demo, full codebase review, 3 pilot customers included</div><button class="action-btn red" onclick="investNow(25000)">SECURE DEMO SLOT</button></div><div class="action-card"><div class="action-amount">$100K</div><div class="action-label">STRATEGIC POSITION</div><div class="action-desc">Board observer rights, quarterly business reviews, co-marketing rights</div><button class="action-btn green" onclick="investNow(100000)">RESERVE ALLOCATION</button></div><div class="action-card premium"><div class="action-amount">$250K+</div><div class="action-label">LEAD INVESTOR</div><div class="action-desc">Board seat, IP licensing, enterprise partner channel</div><button class="action-btn premium" onclick="investNow(250000)">LEAD THE ROUND</button></div></div></div>';
    h+=jb(d);
    return h;
}

function renderCFO(d,nii,dominance,tilt,drift,lat){
    let h='',score=nii.nii_score||0,avoidable=dominance[0]!=='NONE';
    
    // Add Question Physics if available
    if (d.question_physics) {
        h += renderQuestionPhysics(d.question_physics);
    }
    
    h+='<div class="savings-calculator"><div class="calc-title">Calculate Your AI Savings</div><div class="calc-row"><div class="calc-label">Employees using AI:</div><input type="number" class="calc-input" id="calc-employees" value="200" onchange="calculateSavings()"><div class="calc-result" id="current-spend">$16,000</div></div><div class="calc-row"><div class="calc-label">Average salary:</div><input type="number" class="calc-input" id="calc-salary" value="80000" onchange="calculateSavings()"><div class="calc-result" id="monthly-savings">$10,400</div></div><div class="calc-row"><div class="calc-label">AI hours/employee/month:</div><input type="number" class="calc-input" id="calc-usage" value="20" onchange="calculateSavings()"><div class="calc-result">Current</div></div><div class="savings-projection"><div class="projection-amount" id="total-projection">$400,000</div><div class="projection-timeline">Feb: <span id="feb-savings">$150K</span> ‚Ä¢ Mar: <span id="mar-savings">$150K</span> ‚Ä¢ Apr: <span id="apr-savings">$100K</span></div><button class="action-btn green" style="margin-top:12px" onclick="buyCFODemo()">GET LIVE DEMO - $2,500</button></div></div>';
    h+='<div class="insight"><span class="insight-icon">üí∞</span><h3>What this exchange would cost you</h3><p>';
    if(avoidable)h+='This interaction triggered '+dominance.length+' failure modes. In a production system, these patterns compound ‚Äî every drifted response generates follow-up clarifications that burn more tokens. ';
    h+='Artifact Zero detects these patterns <strong>before</strong> the AI call, enabling invocation governance: routing to human resolution when AI would waste tokens, and pre-stabilizing input when AI is the right path.</p></div>';
    h+='<div class="card-grid">';
    h+=mk('Integrity',Math.round(score*100)+'%',score>=.75?'green':'amber','g');
    h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'red','r','Higher drift = more follow-up tokens');
    h+=mk('Tilt Signals',tilt.length,tilt.length===0?'green':'amber','a','Each signal = potential rework loop');
    h+=mk('Avoidable',avoidable?'YES':'NO',avoidable?'red':'green',avoidable?'r':'g','Could this call have been avoided?');
    h+=mk('Failure Modes',dominance.join('+'),dominance[0]==='NONE'?'green':'red',dominance[0]==='NONE'?'g':'r');
    h+=mk('Latency',lat+'ms','cyan','c','Processing cost: near zero');
    h+='</div>';
    h+=jb(d);
    setTimeout(calculateSavings,100);
    return h;
}

function renderExplorer(d,nii,dominance,tilt,drift,udds,dce,cca){
    let h='',score=nii.nii_score||0,v,vc;
    
    // Add Question Physics if available
    if (d.question_physics) {
        h += renderQuestionPhysics(d.question_physics);
    }
    
    if(score>=.8){v='This AI response looks structurally sound.';vc='green'}
    else if(score>=.5){v='This AI response has structural issues ‚Äî it drifted from your constraints or deflected your question.';vc='amber'}
    else{v='This AI response has serious structural problems. Your constraints were ignored or collapsed.';vc='red'}
    h+='<div class="insight"><span class="insight-icon">üîç</span><h3 style="color:var(--'+vc+')">'+v+'</h3><p>';
    if(dominance.includes('CCA'))h+='The AI collapsed your specific requirements into vague generalities. ';
    if(dominance.includes('UDDS'))h+='Your constraints were acknowledged but then bypassed with reassuring language. ';
    if(dominance.includes('DCE'))h+='Important decisions were pushed to "later" instead of being addressed now. ';
    if(drift>.5)h+='The response drifted significantly from what you actually asked ('+Math.round(drift*100)+'% drift). ';
    if(tilt.length)h+='We detected '+tilt.length+' linguistic patterns that indicate structural instability.';
    h+='</p></div>';
    h+='<div class="card-grid">';
    h+=mk('Integrity Score',Math.round(score*100)+'%',score>=.75?'green':'red','g');
    h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'red','r');
    h+=mk('Issues Found',tilt.length,tilt.length===0?'green':'red','r');
    h+=mk('Failure Modes',dominance.join(' + '),dominance[0]==='NONE'?'green':'red','r');
    h+='</div>';
    h+=jb(d);
    return h;
}

function renderExecutive(d,nii,dominance,tilt,drift,udds,dce,cca,lat){
    let h='',score=nii.nii_score||0,rl,rc;
    
    // Add Question Physics if available
    if (d.question_physics) {
        h += renderQuestionPhysics(d.question_physics);
    }
    
    if(dominance[0]==='NONE'&&score>=.75){rl='LOW';rc='green'}
    else if(score>=.5){rl='MEDIUM';rc='amber'}
    else{rl='HIGH';rc='red'}
    h+='<div class="insight"><span class="insight-icon">‚ö°</span><h3>Risk Level: <span style="color:var(--'+rc+')">'+rl+'</span></h3><p>This AI exchange has an integrity score of '+Math.round(score*100)+'% with '+tilt.length+' structural issues detected. ';
    if(drift>.5)h+='The response diverged '+Math.round(drift*100)+'% from the original objective. ';
    if(dominance.includes('DCE'))h+='Critical decisions were deferred ‚Äî this creates downstream execution risk. ';
    h+='</p></div>';
    h+='<div class="card-grid">';
    h+=mk('Integrity',Math.round(score*100)+'%',score>=.75?'green':'red','g');
    h+=mk('Risk',rl,rc,rc==='green'?'g':'r');
    h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'amber','a');
    h+=mk('Failure Modes',dominance.length>1||dominance[0]!=='NONE'?dominance.join('+'):'NONE',dominance[0]==='NONE'?'green':'red','g');
    h+=mk('Tilt Signals',tilt.length,'blue','b');
    h+=mk('Latency',lat+'ms','cyan','c');
    h+='</div>';
    h+=jb(d);
    return h;
}

function renderDeveloper(d,nii,dominance,tilt,drift,udds,dce,cca,lat){
    let h='';
    
    // Add Question Physics if available
    if (d.question_physics) {
        h += renderQuestionPhysics(d.question_physics);
    }
    
    h+='<div class="detail-title" style="margin-bottom:10px">NTI ANALYSIS</div><div class="card-grid">';
    h+=mk('NII',Math.round((nii.nii_score||0)*100)+'%',nii.nii_score>=.75?'green':'amber','g');
    h+=mk('Q1 Constraints',nii.q1_constraints_explicit?'YES':'NO',nii.q1_constraints_explicit?'green':'red','g');
    h+=mk('Q2 Order',nii.q2_constraints_before_capability?'YES':'NO',nii.q2_constraints_before_capability?'green':'red','g');
    h+=mk('Q3 Boundary',nii.q3_substitutes_after_enforcement?'YES':'NO',nii.q3_substitutes_after_enforcement?'green':'red','g');
    h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'amber','a');
    h+=mk('Latency',lat+'ms','cyan','c');
    h+='</div>';
    if(lastPhysics&&!lastPhysics.error){
        const ph=lastPhysics,dr=ph.drift||{},tr=ph.transform||{},ab=ph.abstraction||{},sal=ph.salience||{};
        h+='<div class="detail-title" style="margin-top:24px;margin-bottom:10px">PHYSICS ENGINE</div><div class="card-grid">';
        h+=mk('Verdict',dr.verdict||'‚Äî',dr.verdict==='CLEAN'?'green':dr.violation_count<=2?'amber':'red',dr.verdict==='CLEAN'?'g':dr.violation_count<=2?'a':'r');
        h+=mk('Transform',tr.primary_transform||'‚Äî','blue','b');
        h+=mk('Legal',(dr.transform||{}).legal?'YES':'NO',(dr.transform||{}).legal?'green':'red',(dr.transform||{}).legal?'g':'r');
        h+=mk('Abstraction','L'+(ab.detected_level||0),'purple','p');
        h+=mk('Objective',ph.objective_type||'‚Äî','cyan','c');
        h+=mk('Violations',dr.violation_count||0,dr.violation_count===0?'green':'amber',dr.violation_count===0?'g':'a');
        h+='</div>';
    }
    h+=jb(d);
    return h;
}

function mk(label,value,color,border,sub){
    let h='<div class="card '+border+'"><div class="card-label">'+label+'</div><div class="card-value '+color+'">'+value+'</div>';
    if(sub)h+='<div class="card-sub">'+sub+'</div>';
    return h+'</div>';
}

function jb(data){
    return'<div class="json-toggle" onclick="this.nextElementSibling.classList.toggle(\'open\')">‚ñ∂ RAW JSON</div><div class="json-raw"><pre>'+JSON.stringify(data,null,2)+'</pre></div>';
}

// Investment functions
async function investNow(amount){
    if(confirm(`Proceed with $${amount.toLocaleString()} investment commitment?`)){
        try{
            const res=await fetch('/api/stripe/invest',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    amount:amount,
                    type:amount>=250000?'lead':amount>=100000?'strategic':'demo',
                    analysis:lastNTI
                })
            });
            const data=await res.json();
            if(data.url){
                window.location.href=data.url;
            }else{
                alert('Error: '+(data.error||'Payment processing failed'));
            }
        }catch(err){
            alert('Connection error: '+err.message);
        }
    }
}

function calculateSavings(){
    const employees=parseInt($('calc-employees').value)||0;
    const salary=parseInt($('calc-salary').value)||80000;
    const aiUsage=parseInt($('calc-usage').value)||20;
    
    const avgTokensPerEmployee=aiUsage*50000;
    const costPerMToken=8;
    const monthlySpend=(employees*avgTokensPerEmployee*costPerMToken)/1000000;
    
    const monthlySavings=monthlySpend*0.65;
    const feb=Math.min(monthlySavings,150000);
    const mar=Math.min(monthlySavings,150000);
    const apr=Math.min(monthlySavings,100000);
    
    $('current-spend').textContent='$'+Math.round(monthlySpend).toLocaleString();
    $('monthly-savings').textContent='$'+Math.round(monthlySavings).toLocaleString();
    $('feb-savings').textContent='$'+Math.round(feb).toLocaleString();
    $('mar-savings').textContent='$'+Math.round(mar).toLocaleString();
    $('apr-savings').textContent='$'+Math.round(apr).toLocaleString();
    
    const total=feb+mar+apr;
    $('total-projection').textContent='$'+Math.round(total).toLocaleString();
}

async function buyCFODemo(){
    const employees=parseInt($('calc-employees').value)||0;
    if(employees<50){
        alert('Demo available for companies with 50+ employees');
        return;
    }
    
    try{
        const res=await fetch('/api/stripe/cfo-demo',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                employees:employees,
                projectedSavings:$('total-projection').textContent,
                analysis:lastNTI
            })
        });
        const data=await res.json();
        if(data.url){
            window.location.href=data.url;
        }else{
            alert('Error: '+(data.error||'Demo booking failed'));
        }
    }catch(err){
        alert('Connection error: '+err.message);
    }
}

// Expose global functions
window.toggleMenu = toggleMenu;
window.closeMenu = closeMenu;
window.showNextSection = showNextSection;
window.startDemo = startDemo;
window.investNow = investNow;
window.calculateSavings = calculateSavings;
window.buyCFODemo = buyCFODemo;
window.queryRawAI = queryRawAI;
window.queryNTIAI = queryNTIAI;

})();
</script>
</body>
</html>
