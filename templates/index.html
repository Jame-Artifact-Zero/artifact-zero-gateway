<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>NTI</title>

<style>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #0e1116;
    color: #e8e8e8;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

header {
    position: fixed;
    top: 0;
    width: 100%;
    background: #12161c;
    padding: 10px;
    display: flex;
    justify-content: center;
    gap: 8px;
    z-index: 10;
    border-bottom: 1px solid #1f252f;
}

button {
    background: #1f252f;
    color: #e8e8e8;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    font-size: 14px;
}

button.active {
    background: #2f6df6;
}

main {
    margin-top: 60px;
    padding: 15px;
    flex: 1;
    overflow-y: auto;
}

textarea {
    width: 100%;
    height: 120px;
    background: #161b22;
    color: #e8e8e8;
    border: 1px solid #2a313c;
    border-radius: 6px;
    padding: 10px;
    resize: none;
    font-size: 14px;
}

.output {
    margin-top: 15px;
    padding: 14px;
    border-radius: 8px;
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 15px;
}

/* BASE */
.base {
    background: #161b22;
}

/* LOW */
.low {
    background: #111827;
    color: #dbeafe;
}

/* HIGH */
.high {
    background: #0b1220;
    color: #f1f5ff;
    font-weight: 500;
}

.constraint {
    color: #3b82f6;
}

.absolute {
    color: #ef4444;
}

.authority {
    color: #a855f7;
}

.certainty {
    color: #f97316;
}

</style>
</head>
<body>

<header>
    <button id="baseBtn" class="active">BASE</button>
    <button id="lowBtn">LOW</button>
    <button id="highBtn">HIGH</button>
    <button id="clearBtn">CLEAR</button>
</header>

<main>

<textarea id="inputBox" placeholder="Paste text... (Enter = send, Shift+Enter = new line)"></textarea>

<div id="output" class="output base"></div>

</main>

<script>

let currentMode = "base";

const inputBox = document.getElementById("inputBox");
const output = document.getElementById("output");

const baseBtn = document.getElementById("baseBtn");
const lowBtn = document.getElementById("lowBtn");
const highBtn = document.getElementById("highBtn");
const clearBtn = document.getElementById("clearBtn");

function setMode(mode) {
    currentMode = mode;

    baseBtn.classList.remove("active");
    lowBtn.classList.remove("active");
    highBtn.classList.remove("active");

    if (mode === "base") baseBtn.classList.add("active");
    if (mode === "low") lowBtn.classList.add("active");
    if (mode === "high") highBtn.classList.add("active");

    renderText(lastText);
}

function highlight(text) {
    let result = text;

    if (currentMode === "low" || currentMode === "high") {

        result = result.replace(/\b(must|cannot|can't|should|policy|security|secret)\b/gi,
            '<span class="constraint">$1</span>');

        result = result.replace(/\b(always|never|everyone|no one)\b/gi,
            '<span class="absolute">$1</span>');

        result = result.replace(/\b(experts agree|research shows|industry standard)\b/gi,
            '<span class="authority">$1</span>');

        result = result.replace(/\b(guarantees|eliminates|perfect|all risk)\b/gi,
            '<span class="certainty">$1</span>');
    }

    return result;
}

let lastText = "";

function renderText(text) {
    lastText = text;
    output.className = "output " + currentMode;
    output.innerHTML = highlight(text);
}

inputBox.addEventListener("keydown", function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        submitText();
    }
});

function submitText() {
    const text = inputBox.value.trim();
    if (!text) return;

    fetch("/nti", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ text: text })
    })
    .then(response => response.json())
    .then(data => {
        renderText(text);
        inputBox.value = "";
        window.scrollTo(0, 0);
    })
    .catch(error => {
        console.error("Error:", error);
    });
}

baseBtn.onclick = () => setMode("base");
lowBtn.onclick = () => setMode("low");
highBtn.onclick = () => setMode("high");

clearBtn.onclick = () => {
    output.innerHTML = "";
    inputBox.value = "";
};

</script>

</body>
</html>
