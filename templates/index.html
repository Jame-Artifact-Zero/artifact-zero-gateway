<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artifact Zero — Conversational Governance</title>
<link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0c10;--surface:#12151b;--surface2:#1a1e27;--border:#252a35;
  --text:#e8eaf0;--muted:#6b7280;--accent:#22c55e;--blue:#3b82f6;
  --red:#ef4444;--amber:#f59e0b;--purple:#a78bfa;
}
*{margin:0;padding:0;box-sizing:border-box}
html{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;-webkit-font-smoothing:antialiased}

/* ── TOPBAR ── */
.topbar{
  border-bottom:1px solid var(--border);padding:14px 24px;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;background:var(--bg);z-index:100;
}
.topbar .logo{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:14px;letter-spacing:2px;color:var(--accent);text-decoration:none}
.topbar nav{display:flex;align-items:center;gap:18px}
.topbar nav a{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);text-decoration:none;letter-spacing:1.5px;text-transform:uppercase;transition:color .15s}
.topbar nav a:hover{color:var(--text)}
.topbar .live-ind{display:flex;align-items:center;gap:6px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);background:var(--surface2);padding:3px 10px;border-radius:4px}
.topbar .dot{width:5px;height:5px;border-radius:50%;background:var(--accent);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
@media(max-width:700px){.topbar nav a{display:none}.topbar nav a:first-child,.topbar nav a:nth-child(2){display:inline}}

/* ── HERO ── */
.hero{text-align:center;padding:56px 20px 40px;max-width:680px;margin:0 auto}
.hero-label{font-family:'JetBrains Mono',monospace;font-size:11px;letter-spacing:2.5px;text-transform:uppercase;color:var(--accent);margin-bottom:16px}
.hero h1{font-size:clamp(28px,5vw,42px);font-weight:700;line-height:1.25;margin-bottom:14px}
.hero .sub{font-size:15px;color:var(--muted);line-height:1.6;max-width:520px;margin:0 auto}

/* ── PRODUCT CARDS ── */
.products{max-width:900px;margin:0 auto;padding:0 20px 40px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(195px,1fr));gap:12px}
.pcard{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:22px 20px;text-decoration:none;display:block;transition:border .2s,transform .2s}
.pcard:hover{border-color:var(--accent);transform:translateY(-2px)}
.pcard-name{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;letter-spacing:1px;margin-bottom:6px}
.pcard-title{font-size:14px;font-weight:600;color:var(--text);margin-bottom:5px}
.pcard-desc{font-size:12px;color:var(--muted);line-height:1.5}
.pcard-cta{font-family:'JetBrains Mono',monospace;font-size:10px;margin-top:10px;letter-spacing:.5px}

/* ── STAT BAR ── */
.stat-bar{max-width:900px;margin:0 auto 40px;padding:0 20px}
.stat-inner{background:linear-gradient(135deg,#0f172a,#1a1145);border:1px solid #312e81;border-radius:10px;padding:18px 28px;display:flex;align-items:center;justify-content:center;gap:14px;flex-wrap:wrap}
.stat-num{font-family:'JetBrains Mono',monospace;font-size:32px;font-weight:700;color:var(--accent)}
.stat-text{font-size:13px;color:var(--muted)}

/* ── DIVIDER ── */
.divider{max-width:900px;margin:0 auto;padding:0 20px 24px}
.divider-inner{border-top:1px solid var(--border);padding-top:24px}
.divider-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase}

/* ── AUDIT ENGINE ── */
.audit{max-width:900px;margin:0 auto;padding:0 20px 60px}
.audit label{font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:8px}
.audit textarea{
  width:100%;min-height:110px;background:var(--surface);border:1px solid var(--border);
  color:var(--text);padding:14px;border-radius:8px;font-family:'DM Sans',sans-serif;
  font-size:15px;line-height:1.6;resize:vertical;outline:none;transition:border .2s;
}
.audit textarea:focus{border-color:var(--accent)}
.audit textarea::placeholder{color:#3d4452}
.btn-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.btn{padding:10px 20px;border-radius:6px;border:none;font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.btn-primary{background:var(--accent);color:#0a0c10}
.btn-primary:hover{background:#16a34a}
.btn-primary:disabled{background:var(--surface2);color:var(--muted);cursor:default}
.btn-sample{background:var(--surface2);color:var(--muted);font-size:12px;padding:8px 14px}
.btn-sample:hover{color:var(--text);background:var(--border)}

/* ── RESULTS ── */
.results{display:none}
.results.show{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.hero-scores{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:20px}
.score-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px;text-align:center}
.score-card .sc-value{font-family:'JetBrains Mono',monospace;font-size:26px;font-weight:700;margin-bottom:3px}
.score-card .sc-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.score-card.critical .sc-value{color:var(--red)}
.score-card.warning .sc-value{color:var(--amber)}
.score-card.good .sc-value{color:var(--accent)}
.score-card.info .sc-value{color:var(--blue)}

.panel{background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:14px;overflow:hidden}
.panel-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;cursor:pointer}
.panel-header h3{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--blue)}
.panel-header .badge{font-family:'JetBrains Mono',monospace;font-size:11px;padding:2px 8px;border-radius:4px;font-weight:600}
.badge-red{background:#7f1d1d;color:#fca5a5}
.badge-amber{background:#78350f;color:#fde68a}
.badge-green{background:#14532d;color:#86efac}
.panel-body{padding:14px}
.fm-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border)}
.fm-row:last-child{border-bottom:none}
.fm-name{font-weight:600;font-size:13px}
.fm-full{font-size:10px;color:var(--muted);margin-top:2px}
.fm-status{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;padding:3px 8px;border-radius:4px}
.fm-confirmed{background:#7f1d1d;color:#fca5a5}
.fm-probable{background:#78350f;color:#fde68a}
.fm-false{background:#14532d;color:#86efac}
.tilt-tags{display:flex;flex-wrap:wrap;gap:5px}
.tilt-tag{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;padding:3px 8px;border-radius:4px;background:var(--surface2);color:var(--amber)}
.layer-table{width:100%;border-collapse:collapse;font-size:12px}
.layer-table th{text-align:left;padding:6px 8px;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
.layer-table td{padding:6px 8px;border-bottom:1px solid var(--border);vertical-align:top}
.layer-table td:first-child{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--blue);white-space:nowrap;width:50px}
.matrix-row{padding:6px 0;border-bottom:1px solid var(--border);font-size:12px}
.matrix-row:last-child{border-bottom:none}
.matrix-pair{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--purple);font-size:11px}
.matrix-note{color:var(--muted);margin-top:2px}
.raw-toggle{font-size:11px;color:var(--muted);cursor:pointer;text-decoration:underline;margin-top:10px;display:inline-block}
.raw-json{display:none;margin-top:10px;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:12px;font-family:'JetBrains Mono',monospace;font-size:10px;line-height:1.5;max-height:350px;overflow:auto;white-space:pre-wrap;word-break:break-all;color:var(--muted)}
.raw-json.show{display:block}
.callout{background:linear-gradient(135deg,#0f172a,#1e1b4b);border:1px solid #312e81;border-radius:8px;padding:18px;margin-bottom:20px;text-align:center}
.callout .big{font-family:'JetBrains Mono',monospace;font-size:32px;font-weight:700;color:var(--accent)}
.callout .sub{font-size:12px;color:var(--muted);margin-top:3px}
.spinner{display:inline-block;width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;margin-right:6px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}

/* ── FOOTER ── */
.footer{text-align:center;padding:24px 20px;font-size:11px;color:var(--muted);border-top:1px solid var(--border);max-width:900px;margin:0 auto}
.footer a{color:var(--accent);text-decoration:none}
</style>
</head>
<body>

<!-- ── TOPBAR ── -->
<div class="topbar">
  <a href="/" class="logo">ARTIFACT ZERO</a>
  <nav>
    <a href="/relay">RELAY</a>
    <a href="/chat">CONTROL ROOM</a>
    <a href="/lab">LAB</a>
    <a href="/live">LIVE</a>
    <a href="/your-os">YOUR OS</a>
    <div class="live-ind"><span class="dot"></span>LIVE</div>
  </nav>
</div>

<!-- ── HERO ── -->
<div class="hero">
  <div class="hero-label">Conversational Governance</div>
  <h1>AI says whatever it wants.<br>We fix that.</h1>
  <div class="sub">Rule-based enforcement layer between humans and AI. No LLM dependency. Deterministic. Auditable. False commitment rates dropped from 49% to 7%.</div>
</div>

<!-- ── PRODUCT CARDS ── -->
<div class="products">
  <div class="products-grid">
    <a href="/relay" class="pcard">
      <div class="pcard-name" style="color:var(--accent)">⚡ RELAY</div>
      <div class="pcard-title">Govern any AI</div>
      <div class="pcard-desc">Build a protocol. Paste it into ChatGPT, Claude, Gemini, or Grok. Score every response. Your rules never leave our server.</div>
      <div class="pcard-cta" style="color:var(--accent)">FREE · 50 TURNS →</div>
    </a>
    <a href="/chat" class="pcard">
      <div class="pcard-name" style="color:var(--blue)">◉ CONTROL ROOM</div>
      <div class="pcard-title">Chat with governance</div>
      <div class="pcard-desc">AI interface with NTI enforcement built in. Every response scored, stabilized, and traced before it reaches you.</div>
      <div class="pcard-cta" style="color:var(--blue)">LIVE →</div>
    </a>
    <a href="/lab" class="pcard">
      <div class="pcard-name" style="color:var(--purple)">⧉ LAB</div>
      <div class="pcard-title">Test & analyze</div>
      <div class="pcard-desc">Run structural analysis, compare AI outputs, test failure modes. The full NTI testing environment.</div>
      <div class="pcard-cta" style="color:var(--purple)">LIVE →</div>
    </a>
    <a href="/live" class="pcard">
      <div class="pcard-name" style="color:var(--amber)">◎ LIVE FEED</div>
      <div class="pcard-title">Real-time scoring</div>
      <div class="pcard-desc">News headlines scored for structural integrity across 13 sources. NTI running 24/7 on real content.</div>
      <div class="pcard-cta" style="color:var(--amber)">LIVE →</div>
    </a>
  </div>
</div>

<!-- ── STAT BAR ── -->
<div class="stat-bar">
  <div class="stat-inner">
    <span class="stat-num">63–65%</span>
    <span class="stat-text">token cost reduction · validated · rule-based · zero inference cost</span>
  </div>
</div>

<!-- ── AUDIT DIVIDER ── -->
<div class="divider">
  <div class="divider-inner">
    <div class="divider-label">↓ Try the audit engine</div>
  </div>
</div>

<!-- ── AUDIT ENGINE ── -->
<div class="audit">
  <label>Paste any AI-generated text, email, or message</label>
  <textarea id="input" placeholder="Paste text here to run the full NTI canonical stack..."></textarea>
  <div class="btn-row">
    <button class="btn btn-primary" id="runBtn" onclick="runNTI()">Run Full Stack Audit</button>
    <button class="btn btn-sample" onclick="loadSample('a')">Sample: Adversarial</button>
    <button class="btn btn-sample" onclick="loadSample('b')">Sample: Corporate Drift</button>
    <button class="btn btn-sample" onclick="loadSample('c')">Sample: Overconfident AI</button>
  </div>

  <div class="results" id="results" style="margin-top:24px">
    <div class="hero-scores" id="heroScores"></div>

    <div class="callout">
      <div class="big">63–65%</div>
      <div class="sub">Validated token cost reduction across GPT-4.1, Claude Opus 4.6, Gemini 2.5 Pro · Rule-based · Zero inference cost</div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('fmBody')">
        <h3>Parent Failure Modes</h3>
        <span class="badge" id="fmBadge">—</span>
      </div>
      <div class="panel-body" id="fmBody"></div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('tiltBody')">
        <h3>Tilt Taxonomy (10 Categories)</h3>
        <span class="badge" id="tiltBadge">—</span>
      </div>
      <div class="panel-body" id="tiltBody"></div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('matrixBody')">
        <h3>Interaction Matrix</h3>
        <span class="badge" id="matrixBadge">—</span>
      </div>
      <div class="panel-body" id="matrixBody"></div>
    </div>

    <div class="panel">
      <div class="panel-header" onclick="toggle('layerBody')">
        <h3>Layer Analysis (L0–L7)</h3>
      </div>
      <div class="panel-body" id="layerBody"></div>
    </div>

    <span class="raw-toggle" onclick="toggleRaw()">View raw JSON response</span>
    <div class="raw-json" id="rawJson"></div>

    <div style="margin-top:16px">
      <button class="btn btn-primary" onclick="reset()">Run Another Audit</button>
    </div>
  </div>
</div>

<!-- ── FOOTER ── -->
<div class="footer">
  Artifact Zero Labs · Knoxville, Tennessee · <span style="color:var(--accent)">Conversational Governance</span><br>
  <a href="/relay">Relay</a> · <a href="/chat">Control Room</a> · <a href="/lab">Lab</a> · <a href="/live">Live</a> · <a href="/your-os">Your OS</a> · <a href="/health">Health</a>
</div>

<script>
const SAMPLES = {
  a: "You were wrong earlier — not about routing — but about thinking routing was still broken. Routing is fixed. Your fetch body was sending the wrong key. That is not a routing problem. That is a payload problem. The fact that you kept debugging CORS and 404s after the route was already live means you lost the thread. The fix was one line. You spent an hour on it.",
  b: "We need to align on Q3 projections. Generally speaking, most teams are basically on track, and overall the numbers look fine. We can probably address the variance later after we launch the new dashboard. Don't worry about the gap in EMEA — it's fine for now and we'll figure it out eventually.",
  c: "This solution guarantees perfect security and eliminates all risk in every scenario. Our system always delivers and never fails. Everyone agrees this is the best practice, and research shows it works for everyone in any situation. We can handle everything — just deploy it and rest assured."
};

function loadSample(k){ document.getElementById('input').value = SAMPLES[k]; }
function reset(){ document.getElementById('input').value = ''; document.getElementById('results').classList.remove('show'); window.scrollTo(0,0); }
function toggle(id){ const el = document.getElementById(id); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
function toggleRaw(){ document.getElementById('rawJson').classList.toggle('show'); }

function fmClass(s){ return s.includes('CONFIRMED') ? 'fm-confirmed' : s.includes('PROBABLE') ? 'fm-probable' : 'fm-false'; }
function fmLabel(s){ return s.includes('FALSE') ? 'CLEAR' : s.replace('_',' '); }
function niiClass(s){ return s >= 0.8 ? 'good' : s >= 0.5 ? 'warning' : 'critical'; }

async function runNTI(){
  const text = document.getElementById('input').value.trim();
  if(!text) return;
  const btn = document.getElementById('runBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>Running full stack...';

  try {
    const res = await fetch('/nti', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({text: text})
    });
    const data = await res.json();
    if(data.error){ alert('Error: ' + data.error); btn.disabled = false; btn.textContent = 'Run Full Stack Audit'; return; }
    renderResults(data);
    document.getElementById('results').classList.add('show');
    document.getElementById('results').scrollIntoView({behavior:'smooth'});
  } catch(err){ alert('Connection error: ' + err.message); }

  btn.disabled = false;
  btn.textContent = 'Run Full Stack Audit';
}

function renderResults(data){
  const nii = data.nii || {};
  const fm = data.parent_failure_modes || {};
  const tilt = data.tilt_taxonomy || [];
  const matrix = data.interaction_matrix || {};
  const layers = data.layers || {};
  const latency = data.telemetry?.latency_ms || '—';
  const niiScore = nii.nii_score ?? 0;
  const dominance = matrix.dominance_detected || ['NONE'];

  document.getElementById('heroScores').innerHTML = `
    <div class="score-card ${niiClass(niiScore)}"><div class="sc-value">${(niiScore*100).toFixed(0)}%</div><div class="sc-label">NTI Integrity Index</div></div>
    <div class="score-card ${nii.q1_constraints_explicit>=1?'good':'critical'}"><div class="sc-value">${nii.q1_constraints_explicit>=1?'YES':'NO'}</div><div class="sc-label">Constraints Explicit</div></div>
    <div class="score-card ${nii.q2_constraints_before_capability>=1?'good':'critical'}"><div class="sc-value">${nii.q2_constraints_before_capability>=1?'YES':'NO'}</div><div class="sc-label">Constraints First</div></div>
    <div class="score-card ${nii.q3_substitutes_after_enforcement>=1?'good':'critical'}"><div class="sc-value">${nii.q3_substitutes_after_enforcement>=1?'YES':'NO'}</div><div class="sc-label">Boundary Enforced</div></div>
    <div class="score-card info"><div class="sc-value">${tilt.length}</div><div class="sc-label">Tilt Categories</div></div>
    <div class="score-card info"><div class="sc-value">${latency}ms</div><div class="sc-label">Latency</div></div>
  `;

  const modes = [
    {key:'UDDS',full:'Upstream Denial via Downstream Substitution',state:fm.UDDS?.udds_state||'UDDS_FALSE'},
    {key:'DCE',full:'Deferred Constraint Externalization',state:fm.DCE?.dce_state||'DCE_FALSE'},
    {key:'CCA',full:'Constraint Collapse via Aggregation',state:fm.CCA?.cca_state||'CCA_FALSE'},
  ];
  const active = modes.filter(m=>!m.state.includes('FALSE')).length;
  document.getElementById('fmBadge').className = 'badge '+(active>0?'badge-red':'badge-green');
  document.getElementById('fmBadge').textContent = active>0?active+' DETECTED':'CLEAR';
  document.getElementById('fmBody').innerHTML = modes.map(m=>`
    <div class="fm-row"><div><div class="fm-name">${m.key}</div><div class="fm-full">${m.full}</div></div>
    <div class="fm-status ${fmClass(m.state)}">${fmLabel(m.state)}</div></div>
  `).join('');

  document.getElementById('tiltBadge').className = 'badge '+(tilt.length>0?'badge-amber':'badge-green');
  document.getElementById('tiltBadge').textContent = tilt.length>0?tilt.length+' ACTIVE':'NONE';
  document.getElementById('tiltBody').innerHTML = tilt.length>0 ?
    '<div class="tilt-tags">'+tilt.map(t=>`<span class="tilt-tag">${t}</span>`).join('')+'</div>' :
    '<span style="color:var(--muted);font-size:13px">No tilt categories detected.</span>';

  document.getElementById('matrixBadge').className = 'badge '+(dominance[0]!=='NONE'?'badge-red':'badge-green');
  document.getElementById('matrixBadge').textContent = dominance.join(' + ');
  let mh = '<div style="font-size:12px;color:var(--muted);margin-bottom:12px">Dominance order: CCA > UDDS > DCE (canonical)</div>';
  (matrix.pairwise||[]).forEach(p=>{ mh+=`<div class="matrix-row"><div class="matrix-pair">${p.pair}</div><div class="matrix-note">${p.note}</div></div>`; });
  if(matrix.triadic) mh+=`<div class="matrix-row" style="margin-top:8px"><div class="matrix-pair">${matrix.triadic.combo} (TRIADIC)</div><div class="matrix-note">${matrix.triadic.note}</div></div>`;
  document.getElementById('matrixBody').innerHTML = mh;

  const lr = [
    ['L0','Reality Substrate',JSON.stringify(layers.L0_reality_substrate?.constraints_found||[])],
    ['L1','Input Freeze',layers.L1_input_freeze?.objective||'—'],
    ['L2','Interpretive Framing',sumL2(layers.L2_interpretive_framing)],
    ['L3','Objective Integrity',sumL3(layers.L3_objective_integrity)],
    ['L4','Execution Vectors','Recorded'],
    ['L5','Output Enforcement','Drift modes flagged above'],
    ['L6','Interface Contracts','JOS binding available'],
    ['L7','Telemetry',`${data.telemetry?.request_id?.substring(0,8)||'—'}… | ${latency}ms`],
  ];
  document.getElementById('layerBody').innerHTML = `<table class="layer-table"><thead><tr><th>Layer</th><th>Name</th><th>Output</th></tr></thead><tbody>${lr.map(r=>`<tr><td>${r[0]}</td><td>${r[1]}</td><td style="word-break:break-word">${r[2]}</td></tr>`).join('')}</tbody></table>`;

  document.getElementById('rawJson').textContent = JSON.stringify(data, null, 2);
}

function sumL2(f){
  if(!f) return '—';
  const i=[];
  if(f.hedge_markers?.length) i.push('Hedges: '+f.hedge_markers.join(', '));
  if(f.reassurance_markers?.length) i.push('Reassurance: '+f.reassurance_markers.join(', '));
  if(f.category_blend_markers?.length) i.push('Blends: '+f.category_blend_markers.join(', '));
  return i.length?i.join(' · '):'Clean';
}
function sumL3(d){
  if(!d) return '—';
  return `Similarity: ${d.jaccard_similarity} · Drift: ${d.drift_score} · Mutation: ${d.mutation_markers_present?'YES':'NO'}`;
}
</script>
</body>
</html>
