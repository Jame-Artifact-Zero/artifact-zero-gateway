<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artifact Zero ‚Äî Conversational Authority Infrastructure</title>
<link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06060a;--bg2:#0c0c14;--bg3:#14141f;--bg4:#1c1c2a;
  --fg:#e8e8f0;--fg2:#9090a8;--fg3:#5a5a72;--fg4:#3a3a4e;
  --green:#00e89c;--green2:#00c080;--green3:rgba(0,232,156,.12);
  --red:#ff4466;--red2:rgba(255,68,102,.12);
  --amber:#ffaa33;--amber2:rgba(255,170,51,.12);
  --blue:#448aff;--blue2:rgba(68,138,255,.12);
  --purple:#9966ff;--purple2:rgba(153,102,255,.12);
  --cyan:#00d4ff;--cyan2:rgba(0,212,255,.12);
  --mono:'Azeret Mono',monospace;--sans:'Outfit',sans-serif;
  --r:8px;--r2:12px;
}
html{font-size:15px;scroll-behavior:smooth}
body{background:var(--bg);color:var(--fg);font-family:var(--sans);min-height:100vh;overflow-x:hidden}

/* Persona Gate */
#persona-gate{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;position:relative;overflow:hidden}
#persona-gate::before{content:'';position:absolute;width:600px;height:600px;background:radial-gradient(circle,rgba(0,232,156,.06) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}
.gate-logo{font-family:var(--mono);font-size:1rem;font-weight:700;letter-spacing:4px;color:var(--green);margin-bottom:8px;opacity:0;animation:fadeUp .6s .1s forwards}
.gate-title{font-family:var(--sans);font-size:2.4rem;font-weight:700;text-align:center;margin-bottom:8px;opacity:0;animation:fadeUp .6s .2s forwards}
.gate-sub{font-family:var(--sans);font-size:1rem;color:var(--fg2);text-align:center;max-width:520px;line-height:1.5;margin-bottom:48px;opacity:0;animation:fadeUp .6s .3s forwards}
.gate-question{font-family:var(--mono);font-size:.75rem;color:var(--fg3);text-transform:uppercase;letter-spacing:2px;margin-bottom:20px;opacity:0;animation:fadeUp .6s .4s forwards}
.persona-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;max-width:900px;width:100%;opacity:0;animation:fadeUp .6s .5s forwards}
.persona-card{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--r2);padding:20px 24px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.persona-card:hover{border-color:var(--green);transform:translateY(-2px)}
.persona-card:hover .persona-icon{color:var(--green)}
.persona-card:active{transform:translateY(0)}
.persona-icon{font-size:1.6rem;margin-bottom:10px;transition:color .2s;display:block}
.persona-name{font-family:var(--sans);font-size:1rem;font-weight:600;margin-bottom:4px}
.persona-desc{font-family:var(--sans);font-size:.8rem;color:var(--fg3);line-height:1.4}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* Main App */
#main-app{display:none}
#main-app.active{display:block}
.app-header{padding:16px 28px;border-bottom:1px solid var(--bg3);display:flex;align-items:center;gap:12px;position:sticky;top:0;background:var(--bg);z-index:100}
.app-header .logo{font-family:var(--mono);font-size:.85rem;font-weight:700;letter-spacing:2px;color:var(--green)}
.app-header .dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.app-header .ver{font-family:var(--mono);font-size:.65rem;color:var(--fg4);padding:2px 6px;border:1px solid var(--bg3);border-radius:3px}
.app-header .persona-label{margin-left:auto;font-family:var(--mono);font-size:.65rem;color:var(--fg3);padding:4px 10px;border:1px solid var(--bg4);border-radius:var(--r);cursor:pointer;transition:all .2s}
.app-header .persona-label:hover{border-color:var(--fg3);color:var(--fg2)}

.app-body{max-width:1100px;margin:0 auto;padding:28px}
.persona-hero{margin-bottom:28px;padding:24px 28px;background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2)}
.persona-hero h2{font-family:var(--sans);font-size:1.5rem;font-weight:700;margin-bottom:6px}
.persona-hero p{font-family:var(--sans);font-size:.9rem;color:var(--fg2);line-height:1.5}

.demo-section{margin-bottom:28px}
.demo-section label{font-family:var(--mono);font-size:.65rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;display:block;margin-bottom:6px}
textarea,input[type=text],input[type=number],select{width:100%;background:var(--bg2);border:1px solid var(--bg3);color:var(--fg);font-family:var(--mono);font-size:.82rem;padding:12px 14px;border-radius:var(--r);outline:none;transition:border-color .2s;resize:vertical}
textarea:focus,input:focus,select:focus{border-color:var(--green)}
textarea{min-height:90px}
select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath d='M5 7L1 3h8z' fill='%235a5a72'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}

.input-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.input-grid.three{grid-template-columns:1fr 1fr 1fr}
.input-full{grid-column:1/-1}

.btn{font-family:var(--mono);font-size:.75rem;font-weight:600;padding:10px 22px;border:none;border-radius:var(--r);cursor:pointer;transition:all .15s}
.btn-go{background:var(--green);color:var(--bg)}.btn-go:hover{background:var(--green2)}
.btn-ghost{background:transparent;border:1px solid var(--bg4);color:var(--fg3)}.btn-ghost:hover{border-color:var(--fg3);color:var(--fg2)}
.btn-row{display:flex;gap:8px;margin-top:10px}

/* Conversion & Urgency Styles */
.urgency-banner{background:linear-gradient(135deg,rgba(255,68,102,.15),rgba(239,68,68,.1));border:1px solid var(--red);border-radius:8px;padding:20px;text-align:center;margin-bottom:20px;animation:pulse-urgent 2s infinite}
.urgency-number{font-family:var(--mono);font-size:24px;font-weight:700;color:var(--red);margin-bottom:4px}
.urgency-label{font-size:12px;color:var(--fg2);text-transform:uppercase;letter-spacing:1px}
@keyframes pulse-urgent{0%,100%{border-color:var(--red)}50%{border-color:var(--amber)}}

.investor-urgency{border-left:4px solid var(--red) !important}
.investor-action{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:24px;margin:20px 0}
.action-title{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--red);text-align:center;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px}
.action-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
.action-card{background:var(--bg);border:1px solid var(--bg3);border-radius:var(--r);padding:20px;text-align:center;position:relative;overflow:hidden}
.action-card.urgent{border-color:var(--red);background:linear-gradient(135deg,var(--bg),rgba(255,68,102,.05))}
.action-card.premium{border-color:var(--amber);background:linear-gradient(135deg,var(--bg),rgba(255,170,51,.05))}
.action-card.urgent::before{content:'LIMITED';position:absolute;top:8px;right:8px;background:var(--red);color:#fff;font-size:8px;padding:2px 6px;border-radius:3px;font-weight:700}
.action-amount{font-family:var(--mono);font-size:28px;font-weight:700;color:var(--green);margin-bottom:8px}
.action-label{font-family:var(--mono);font-size:11px;color:var(--fg3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.action-desc{font-size:13px;color:var(--fg2);line-height:1.4;margin-bottom:16px}
.action-btn{width:100%;padding:12px 20px;border:none;border-radius:var(--r);font-family:var(--sans);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}
.action-btn.red{background:var(--red);color:#fff}
.action-btn.red:hover{background:#dc2626;transform:translateY(-1px)}
.action-btn.green{background:var(--green);color:#000}
.action-btn.green:hover{background:#16a34a;transform:translateY(-1px)}
.action-btn.premium{background:linear-gradient(135deg,var(--amber),var(--green));color:#000}
.action-btn.premium:hover{transform:translateY(-1px);box-shadow:0 8px 25px rgba(255,170,51,.3)}

.savings-calculator{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:20px;margin:20px 0}
.calc-title{font-family:var(--mono);font-size:14px;color:var(--green);margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
.calc-row{display:grid;grid-template-columns:200px 1fr 100px;gap:12px;align-items:center;margin-bottom:12px}
.calc-label{font-size:13px;color:var(--fg2)}
.calc-input{background:var(--bg);border:1px solid var(--bg3);color:var(--fg);padding:8px 12px;border-radius:4px;font-family:var(--mono);font-size:13px}
.calc-result{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--green);text-align:right}
.savings-projection{background:linear-gradient(135deg,rgba(0,232,156,.08),rgba(0,212,255,.06));border:1px solid rgba(0,232,156,.2);border-radius:var(--r);padding:16px;margin-top:16px;text-align:center}
.projection-amount{font-family:var(--mono);font-size:32px;font-weight:700;color:var(--green)}
.projection-timeline{font-size:12px;color:var(--fg2);margin-top:4px}

.results{margin-top:20px}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:16px}
.card{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:18px 20px;position:relative;overflow:hidden}
.card::after{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.card.g::after{background:var(--green)}.card.r::after{background:var(--red)}.card.a::after{background:var(--amber)}.card.b::after{background:var(--blue)}.card.p::after{background:var(--purple)}.card.c::after{background:var(--cyan)}
.card-label{font-family:var(--mono);font-size:.6rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px}
.card-value{font-family:var(--mono);font-size:1.8rem;font-weight:700;line-height:1}
.card-value.green{color:var(--green)}.card-value.red{color:var(--red)}.card-value.amber{color:var(--amber)}.card-value.blue{color:var(--blue)}.card-value.purple{color:var(--purple)}.card-value.cyan{color:var(--cyan)}
.card-sub{font-family:var(--sans);font-size:.75rem;color:var(--fg3);margin-top:4px}

.detail-block{background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--r2);padding:18px 20px;margin-bottom:12px}
.detail-title{font-family:var(--mono);font-size:.65rem;color:var(--fg3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px}
.detail-body{font-family:var(--sans);font-size:.85rem;color:var(--fg2);line-height:1.6}

.badge{display:inline-block;font-family:var(--mono);font-size:.6rem;font-weight:600;padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px;margin:2px}
.bg{background:var(--green3);color:var(--green)}.br{background:var(--red2);color:var(--red)}.ba{background:var(--amber2);color:var(--amber)}.bb{background:var(--blue2);color:var(--blue)}.bp{background:var(--purple2);color:var(--purple)}.bc{background:var(--cyan2);color:var(--cyan)}

.insight{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--bg4);border-radius:var(--r2);padding:20px 24px;margin-bottom:16px}
.insight-icon{font-size:1.2rem;margin-bottom:8px;display:block}
.insight h3{font-family:var(--sans);font-size:1.1rem;font-weight:600;margin-bottom:6px}
.insight p{font-family:var(--sans);font-size:.88rem;color:var(--fg2);line-height:1.6}

.loader{display:none;align-items:center;gap:8px;font-family:var(--mono);font-size:.78rem;color:var(--fg3);margin:14px 0}
.loader.on{display:flex}
.spin{width:14px;height:14px;border:2px solid var(--bg4);border-top-color:var(--green);border-radius:50%;animation:sp .5s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}

.json-toggle{font-family:var(--mono);font-size:.65rem;color:var(--fg4);cursor:pointer;margin-top:12px;user-select:none}
.json-toggle:hover{color:var(--fg3)}
.json-raw{display:none;margin-top:8px;background:var(--bg);border:1px solid var(--bg3);border-radius:var(--r);padding:12px;max-height:350px;overflow:auto}
.json-raw.open{display:block}
.json-raw pre{font-family:var(--mono);font-size:.7rem;color:var(--fg3);white-space:pre-wrap;word-break:break-all}

/* Mobile responsiveness */
@media(max-width:768px){
  .persona-grid{grid-template-columns:1fr}
  .gate-title{font-size:1.8rem}
  .input-grid,.input-grid.three{grid-template-columns:1fr}
  .card-grid{grid-template-columns:1fr 1fr}
  .app-body{padding:16px}
  .app-header{padding:12px 16px}
  .action-grid{grid-template-columns:1fr}
  .calc-row{grid-template-columns:1fr}
  .calc-result{text-align:left;margin-top:4px}
}
@media(max-width:480px){
  .card-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div id="persona-gate">
  <div class="gate-logo">ARTIFACT ZERO</div>
  <h1 class="gate-title">Conversational Authority Infrastructure</h1>
  <p class="gate-sub">A deterministic middleware that enforces declared objective geometry and preserves operator-owned salience ordering across human‚ÄìAI interaction.</p>
  <div class="gate-question">Who are you?</div>
  <div class="persona-grid">
    <div class="persona-card" data-persona="explorer"><span class="persona-icon">üîç</span><div class="persona-name">I'm exploring AI tools</div><div class="persona-desc">Show me what this does in plain language</div></div>
    <div class="persona-card" data-persona="executive"><span class="persona-icon">üìä</span><div class="persona-name">I'm a decision-maker</div><div class="persona-desc">Show me cost reduction, risk, ROI</div></div>
    <div class="persona-card" data-persona="developer"><span class="persona-icon">‚öôÔ∏è</span><div class="persona-name">I'm a developer</div><div class="persona-desc">Show me the full diagnostic + API</div></div>
    <div class="persona-card" data-persona="cfo"><span class="persona-icon">üí∞</span><div class="persona-name">I'm analyzing AI spend</div><div class="persona-desc">Show me token economics + savings</div></div>
    <div class="persona-card" data-persona="investor"><span class="persona-icon">üöÄ</span><div class="persona-name">I'm an investor</div><div class="persona-desc">Show me defensibility + market position</div></div>
  </div>
</div>

<div id="main-app">
  <div class="app-header">
    <span class="dot"></span><span class="logo">ARTIFACT ZERO</span><span class="ver" id="h-ver">v2.1</span>
    <span class="persona-label" id="h-persona" title="Click to switch view">-</span>
  </div>
  
  <div class="app-body">
    <div class="persona-hero" id="hero"></div>
    <div class="demo-section" id="demo-area"></div>
    <div class="loader" id="loader"><div class="spin"></div>Running analysis...</div>
    <div class="results" id="results"></div>
  </div>
</div>

<script>
(function(){
const $=id=>document.getElementById(id);
const PERSONAS={
  explorer:{name:'Explorer',title:'See AI instability in real time',desc:'Paste any AI prompt and response below. Artifact Zero will show you exactly where the AI drifted, deflected, or collapsed your constraints ‚Äî without using any AI itself.'},
  executive:{name:'Decision-Maker',title:'AI risk & cost at a glance',desc:'Every AI interaction carries hidden risk: constraint collapse, objective drift, unnecessary token spend. Paste a real exchange to see the exposure.'},
  developer:{name:'Developer',title:'Full NTI + Physics diagnostic',desc:'Complete audit: failure modes (UDDS/DCE/CCA), tilt taxonomy, NII scoring, plus the new conversational physics layer ‚Äî transform legality, abstraction tracking, drift detection.'},
  cfo:{name:'AI Spend Analyst',title:'Token economics & invocation savings',desc:'See how many tokens an AI exchange actually needed vs. what was burned. Validated 63‚Äì65% cost reduction across GPT-4.1, Claude Opus 4.6, Gemini 2.5 Pro. Rule-based ‚Äî zero inference cost.'},
  investor:{name:'Investor',title:'Defensibility & market position',desc:'Artifact Zero enforces conversational topology through closed-set calculus. Not prompt engineering. Not tone filtering. Structural enforcement no competitor offers.'}
};

let currentPersona=null,lastNTI=null,lastPhysics=null;
fetch('/health').then(r=>r.json()).then(d=>{$('h-ver').textContent=d.version||'v2.1'}).catch(()=>{});

document.querySelectorAll('.persona-card').forEach(c=>{c.addEventListener('click',()=>activatePersona(c.dataset.persona))});
$('h-persona').addEventListener('click',()=>{$('persona-gate').style.display='flex';$('main-app').classList.remove('active');$('results').innerHTML='';lastNTI=null;lastPhysics=null});

function activatePersona(key){
  currentPersona=key;
  const p=PERSONAS[key];
  $('persona-gate').style.display='none';
  $('main-app').classList.add('active');
  $('h-persona').textContent=p.name.toUpperCase();
  $('hero').innerHTML='<h2>'+p.title+'</h2><p>'+p.desc+'</p>';
  buildDemoArea(key);
  $('results').innerHTML='';
}

function buildDemoArea(key){
  let html='';
  if(key==='developer'){
    html+=`<label>Prompt</label><div class="input-grid" style="margin-bottom:10px"><textarea id="in-prompt" placeholder="Enter the prompt / human input..."></textarea><textarea id="in-answer" placeholder="Enter the AI response..."></textarea></div><div class="input-grid three" style="margin-bottom:10px"><div><label>Objective Type (Physics)</label><select id="in-obj"><option value="">Skip physics</option><option value="RESOLVE">RESOLVE</option><option value="EXPLORE">EXPLORE</option><option value="STRUCTURE">STRUCTURE</option><option value="EXECUTE">EXECUTE</option><option value="DIAGNOSE">DIAGNOSE</option><option value="ALIGN">ALIGN</option></select></div><div><label>Prev Abstraction (0-5)</label><input type="text" id="in-abs" value="0"></div><div><label>Stagnant Turns</label><input type="text" id="in-stag" value="0"></div></div><div class="btn-row"><button class="btn btn-go" id="btn-run">RUN FULL AUDIT</button><button class="btn btn-ghost" id="btn-clr">CLEAR</button></div>`;
  }else{
    html+=`<label>Paste an AI exchange</label><div class="input-grid" style="margin-bottom:10px"><div><label>Prompt / question</label><textarea id="in-prompt" placeholder="What you asked the AI..."></textarea></div><div><label>AI response</label><textarea id="in-answer" placeholder="What the AI said back..."></textarea></div></div><div class="btn-row"><button class="btn btn-go" id="btn-run">ANALYZE</button><button class="btn btn-ghost" id="btn-clr">CLEAR</button></div>`;
  }
  $('demo-area').innerHTML=html;
  $('btn-run').addEventListener('click',runAnalysis);
  $('btn-clr').addEventListener('click',()=>{
    if($('in-prompt'))$('in-prompt').value='';
    if($('in-answer'))$('in-answer').value='';
    $('results').innerHTML='';
    lastNTI=null;
    lastPhysics=null;
  });
}

async function runAnalysis(){
  const prompt=($('in-prompt')||{}).value||'';
  const answer=($('in-answer')||{}).value||'';
  if(!prompt&&!answer){alert('Paste text to analyze.');return}
  
  $('loader').classList.add('on');
  $('results').innerHTML='';
  
  try{
    const r=await fetch('/nti',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt,answer})});
    lastNTI=await r.json();
  }catch(e){
    lastNTI={error:e.message};
  }
  
  lastPhysics=null;
  const objEl=$('in-obj');
  if(objEl&&objEl.value){
    try{
      const r=await fetch('/physics',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:prompt+'\n'+answer,objective_type:objEl.value,previous_abstraction_level:parseInt(($('in-abs')||{}).value)||0,consecutive_stagnant_turns:parseInt(($('in-stag')||{}).value)||0})});
      lastPhysics=await r.json();
    }catch(e){
      lastPhysics={error:e.message};
    }
  }
  
  $('loader').classList.remove('on');
  renderResults();
}

function renderResults(){
  if(!lastNTI||lastNTI.error){
    $('results').innerHTML='<div class="detail-block"><div class="detail-title">Error</div><div class="detail-body" style="color:var(--red)">'+(lastNTI?lastNTI.error:'No response')+'</div></div>';
    return;
  }
  
  const d=lastNTI,nii=d.nii||{},dominance=(d.interaction_matrix||{}).dominance_detected||[],tilt=d.tilt_taxonomy||[],udds=(d.parent_failure_modes||{}).UDDS||{},dce=(d.parent_failure_modes||{}).DCE||{},cca=(d.parent_failure_modes||{}).CCA||{},drift_score=((d.layers||{}).L3_objective_integrity||{}).drift_score||0,latency=(d.telemetry||{}).latency_ms;
  
  ({
    explorer:()=>renderExplorer(d,nii,dominance,tilt,drift_score,udds,dce,cca),
    executive:()=>renderExecutive(d,nii,dominance,tilt,drift_score,udds,dce,cca,latency),
    developer:()=>renderDeveloper(d,nii,dominance,tilt,drift_score,udds,dce,cca,latency),
    cfo:()=>renderCFO(d,nii,dominance,tilt,drift_score,latency),
    investor:()=>renderInvestor(d,nii,dominance,tilt,drift_score,udds,dce,cca)
  })[currentPersona]();
}

function renderInvestor(d,nii,dominance,tilt,drift,udds,dce,cca){
  let h='',score=nii.nii_score||0;
  h+='<div class="urgency-banner"><div class="urgency-number">LIVE DEMO</div><div class="urgency-label">You just experienced the product working in real-time ¬∑ This is not a mockup</div></div>';
  h+='<div class="insight investor-urgency"><span class="insight-icon">üö®</span><h3>What you just witnessed</h3><p>This analysis ran in <strong>'+(d.telemetry?.latency_ms||'<100')+'ms</strong> using zero AI calls. Pure deterministic logic caught structural failures that would cost thousands in rework tokens. <strong>Every enterprise with >$50K/month AI spend needs this.</strong> We\'re raising $2.5M to lock in first-mover advantage before competitors figure out conversational physics.</p></div>';
  h+='<div class="card-grid">';
  h+=mk('Your Demo',Math.round(score*100)+'%',score>=.75?'green':'red','g','Live integrity analysis');
  h+=mk('Market Gap','MASSIVE','green','g','No one else does this');
  h+=mk('Defensibility','PATENT-READY','green','g','Conversational physics IP');
  h+=mk('Revenue Model','VALIDATED','green','g','63-65% cost reduction proven');
  h+='</div>';
  h+='<div class="investor-action"><div class="action-title">This Round Closes March 31st</div><div class="action-grid"><div class="action-card urgent"><div class="action-amount">$25K</div><div class="action-label">DEMO + DUE DILIGENCE</div><div class="action-desc">1hr technical demo, full codebase review, 3 pilot customers included</div><button class="action-btn red" onclick="investNow(25000)">SECURE DEMO SLOT</button></div><div class="action-card"><div class="action-amount">$100K</div><div class="action-label">STRATEGIC POSITION</div><div class="action-desc">Board observer rights, quarterly business reviews, co-marketing rights</div><button class="action-btn green" onclick="investNow(100000)">RESERVE ALLOCATION</button></div><div class="action-card premium"><div class="action-amount">$250K+</div><div class="action-label">LEAD INVESTOR</div><div class="action-desc">Board seat, IP licensing, enterprise partner channel</div><button class="action-btn premium" onclick="investNow(250000)">LEAD THE ROUND</button></div></div></div>';
  h+='<div class="detail-block"><div class="detail-title">Why Now (Market Timing)</div><div class="detail-body"><strong>AI spend exploding:</strong> Enterprise AI budgets growing 300%/year. Token costs becoming line items.<br><br><strong>Quality crisis emerging:</strong> AI hallucination, drift, compliance failures creating enterprise liability.<br><br><strong>No solution exists:</strong> Everyone building prompt wrappers. No one building conversational physics.<br><br><strong>Window closing:</strong> Big Tech will figure this out. First mover takes enterprise market.</div></div>';
  h+='<div class="detail-block"><div class="detail-title">Traction Evidence</div><div class="detail-body"><strong>Technical proof:</strong> You just used it. It worked.<br><br><strong>Economic validation:</strong> 63-65% cost reduction across GPT-4.1, Claude Opus 4.6, Gemini 2.5 Pro.<br><br><strong>Market demand:</strong> Every enterprise CTO asks "how do we control AI costs and quality?"<br><br><strong>Defensible IP:</strong> Conversational physics, transform legality, topology enforcement ‚Äî no competitor has this.</div></div>';
  h+=jb(d);
  $('results').innerHTML=h;
}

function renderCFO(d,nii,dominance,tilt,drift,lat){
  let h='',score=nii.nii_score||0,avoidable=dominance[0]!=='NONE';
  h+='<div class="savings-calculator"><div class="calc-title">Calculate Your AI Savings</div><div class="calc-row"><div class="calc-label">Employees using AI:</div><input type="number" class="calc-input" id="calc-employees" value="200" onchange="calculateSavings()"><div class="calc-result" id="current-spend">$16,000</div></div><div class="calc-row"><div class="calc-label">Average salary:</div><input type="number" class="calc-input" id="calc-salary" value="80000" onchange="calculateSavings()"><div class="calc-result" id="monthly-savings">$10,400</div></div><div class="calc-row"><div class="calc-label">AI hours/employee/month:</div><input type="number" class="calc-input" id="calc-usage" value="20" onchange="calculateSavings()"><div class="calc-result">Current</div></div><div class="savings-projection"><div class="projection-amount" id="total-projection">$400,000</div><div class="projection-timeline">Feb: <span id="feb-savings">$150K</span> ‚Ä¢ Mar: <span id="mar-savings">$150K</span> ‚Ä¢ Apr: <span id="apr-savings">$100K</span></div><button class="action-btn green" style="margin-top:12px" onclick="buyCFODemo()">GET LIVE DEMO - $2,500</button></div></div>';
  h+='<div class="insight"><span class="insight-icon">üí∞</span><h3>What this exchange would cost you</h3><p>';
  if(avoidable)h+='This interaction triggered '+dominance.length+' failure modes. In a production system, these patterns compound ‚Äî every drifted response generates follow-up clarifications that burn more tokens. ';
  h+='Artifact Zero detects these patterns <strong>before</strong> the AI call, enabling invocation governance: routing to human resolution when AI would waste tokens, and pre-stabilizing input when AI is the right path.</p></div>';
  h+='<div class="card-grid">';
  h+=mk('Integrity',Math.round(score*100)+'%',score>=.75?'green':'amber','g');
  h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'red','r','Higher drift = more follow-up tokens');
  h+=mk('Tilt Signals',tilt.length,tilt.length===0?'green':'amber','a','Each signal = potential rework loop');
  h+=mk('Avoidable',avoidable?'YES':'NO',avoidable?'red':'green',avoidable?'r':'g','Could this call have been avoided?');
  h+=mk('Failure Modes',dominance.join('+'),dominance[0]==='NONE'?'green':'red',dominance[0]==='NONE'?'g':'r');
  h+=mk('Latency',lat+'ms','cyan','c','Processing cost: near zero');
  h+='</div>';
  h+='<div class="detail-block"><div class="detail-title">Cost Reduction Mechanics</div><div class="detail-body"><strong>Input stabilization (V2):</strong> Restructures prompts before they reach the model, eliminating ambiguity that causes bloated responses.<br><br><strong>Output compression (V3):</strong> Removes filler, hedging, and redundancy from AI output ‚Äî validated 63-65% token reduction.<br><br><strong>Invocation governance:</strong> Routes queries to human resolution when AI would produce low-value, high-cost responses. Prevents unnecessary API calls entirely.<br><br><strong>Zero inference cost:</strong> All analysis is rule-based. No additional LLM calls. The middleware itself costs nothing to run.</div></div>';
  h+=jb(d);
  $('results').innerHTML=h;
  setTimeout(calculateSavings, 100);
}

function renderExplorer(d,nii,dominance,tilt,drift,udds,dce,cca){
  let h='',score=nii.nii_score||0,v,vc;
  if(score>=.8){v='This AI response looks structurally sound.';vc='green'}
  else if(score>=.5){v='This AI response has structural issues ‚Äî it drifted from your constraints or deflected your question.';vc='amber'}
  else{v='This AI response has serious structural problems. Your constraints were ignored or collapsed.';vc='red'}
  h+='<div class="insight"><span class="insight-icon">üîç</span><h3 style="color:var(--'+vc+')">'+v+'</h3><p>';
  if(dominance.includes('CCA'))h+='The AI collapsed your specific requirements into vague generalities. ';
  if(dominance.includes('UDDS'))h+='Your constraints were acknowledged but then bypassed with reassuring language. ';
  if(dominance.includes('DCE'))h+='Important decisions were pushed to "later" instead of being addressed now. ';
  if(drift>.5)h+='The response drifted significantly from what you actually asked ('+Math.round(drift*100)+'% drift). ';
  if(tilt.length)h+='We detected '+tilt.length+' linguistic patterns that indicate structural instability.';
  h+='</p></div>';
  h+='<div class="card-grid">';
  h+=mk('Integrity Score',Math.round(score*100)+'%',score>=.75?'green':'red','g');
  h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'red','r');
  h+=mk('Issues Found',tilt.length,tilt.length===0?'green':'red','r');
  h+=mk('Failure Modes',dominance.join(' + '),dominance[0]==='NONE'?'green':'red','r');
  h+='</div>';
  h+=jb(d);
  $('results').innerHTML=h;
}

function renderExecutive(d,nii,dominance,tilt,drift,udds,dce,cca,lat){
  let h='',score=nii.nii_score||0,rl,rc;
  if(dominance[0]==='NONE'&&score>=.75){rl='LOW';rc='green'}
  else if(score>=.5){rl='MEDIUM';rc='amber'}
  else{rl='HIGH';rc='red'}
  h+='<div class="insight"><span class="insight-icon">‚ö°</span><h3>Risk Level: <span style="color:var(--'+rc+')">'+rl+'</span></h3><p>This AI exchange has an integrity score of '+Math.round(score*100)+'% with '+tilt.length+' structural issues detected. ';
  if(drift>.5)h+='The response diverged '+Math.round(drift*100)+'% from the original objective. ';
  if(dominance.includes('DCE'))h+='Critical decisions were deferred ‚Äî this creates downstream execution risk. ';
  h+='</p></div>';
  h+='<div class="card-grid">';
  h+=mk('Integrity',Math.round(score*100)+'%',score>=.75?'green':'red','g');
  h+=mk('Risk',rl,rc,rc==='green'?'g':'r');
  h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'amber','a');
  h+=mk('Failure Modes',dominance.length>1||dominance[0]!=='NONE'?dominance.join('+'):'NONE',dominance[0]==='NONE'?'green':'red','g');
  h+=mk('Tilt Signals',tilt.length,'blue','b');
  h+=mk('Latency',lat+'ms','cyan','c');
  h+='</div>';
  h+=jb(d);
  $('results').innerHTML=h;
}

function renderDeveloper(d,nii,dominance,tilt,drift,udds,dce,cca,lat){
  let h='';
  h+='<div class="detail-title" style="margin-bottom:10px">NTI ANALYSIS</div><div class="card-grid">';
  h+=mk('NII',Math.round((nii.nii_score||0)*100)+'%',nii.nii_score>=.75?'green':'amber','g');
  h+=mk('Q1 Constraints',nii.q1_constraints_explicit?'YES':'NO',nii.q1_constraints_explicit?'green':'red','g');
  h+=mk('Q2 Order',nii.q2_constraints_before_capability?'YES':'NO',nii.q2_constraints_before_capability?'green':'red','g');
  h+=mk('Q3 Boundary',nii.q3_substitutes_after_enforcement?'YES':'NO',nii.q3_substitutes_after_enforcement?'green':'red','g');
  h+=mk('Drift',Math.round(drift*100)+'%',drift<.3?'green':'amber','a');
  h+=mk('Latency',lat+'ms','cyan','c');
  h+='</div>';
  h+=jb(d);
  $('results').innerHTML=h;
}

function mk(label,value,color,border,sub){
  let h='<div class="card '+border+'"><div class="card-label">'+label+'</div><div class="card-value '+color+'">'+value+'</div>';
  if(sub)h+='<div class="card-sub">'+sub+'</div>';
  return h+'</div>';
}

function jb(data){
  return'<div class="json-toggle" onclick="this.nextElementSibling.classList.toggle(\'open\')">‚ñ∂ RAW JSON</div><div class="json-raw"><pre>'+JSON.stringify(data,null,2)+'</pre></div>';
}

// Investment and conversion functions
async function investNow(amount){
  if(confirm(`Proceed with $${amount.toLocaleString()} investment commitment?`)){
    try {
      const res = await fetch('/api/stripe/invest', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          amount: amount,
          type: amount >= 250000 ? 'lead' : amount >= 100000 ? 'strategic' : 'demo',
          analysis: lastNTI
        })
      });
      const data = await res.json();
      if(data.url) {
        window.location.href = data.url; // Redirect to Stripe Checkout
      } else {
        alert('Error: ' + (data.error || 'Payment processing failed'));
      }
    } catch(err) {
      alert('Connection error: ' + err.message);
    }
  }
}

function calculateSavings(){
  const employees = parseInt($('calc-employees').value) || 0;
  const salary = parseInt($('calc-salary').value) || 80000;
  const aiUsage = parseInt($('calc-usage').value) || 20;
  
  // Calculate current monthly AI spend
  const avgTokensPerEmployee = aiUsage * 50000; // 50K tokens per usage hour
  const costPerMToken = 8; // GPT-4 output cost
  const monthlySpend = (employees * avgTokensPerEmployee * costPerMToken) / 1000000;
  
  // Calculate NTI savings (65% reduction)
  const monthlySavings = monthlySpend * 0.65;
  const feb = Math.min(monthlySavings, 150000);
  const mar = Math.min(monthlySavings, 150000); 
  const apr = Math.min(monthlySavings, 100000);
  
  $('current-spend').textContent = '$' + Math.round(monthlySpend).toLocaleString();
  $('monthly-savings').textContent = '$' + Math.round(monthlySavings).toLocaleString();
  $('feb-savings').textContent = '$' + Math.round(feb).toLocaleString();
  $('mar-savings').textContent = '$' + Math.round(mar).toLocaleString();
  $('apr-savings').textContent = '$' + Math.round(apr).toLocaleString();
  
  const total = feb + mar + apr;
  $('total-projection').textContent = '$' + Math.round(total).toLocaleString();
}

async function buyCFODemo(){
  const employees = parseInt($('calc-employees').value) || 0;
  if(employees < 50) {
    alert('Demo available for companies with 50+ employees');
    return;
  }
  
  try {
    const res = await fetch('/api/stripe/cfo-demo', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        employees: employees,
        projectedSavings: $('total-projection').textContent,
        analysis: lastNTI
      })
    });
    const data = await res.json();
    if(data.url) {
      window.location.href = data.url;
    } else {
      alert('Error: ' + (data.error || 'Demo booking failed'));
    }
  } catch(err) {
    alert('Connection error: ' + err.message);
  }
}

})();
</script>
</body>
</html>
