{% extends "base.html" %}
{% block title %}The Wall — Artifact Zero{% endblock %}
{% block body_class %}page-wall{% endblock %}

{% block head %}
<style>


.hero{max-width:700px;margin:0 auto;padding:100px 20px 32px;text-align:center}
.hero h1{font-family:'JetBrains Mono',monospace;font-size:clamp(20px,4vw,32px);font-weight:700;margin-bottom:8px}
.hero p{color:var(--muted);font-size:14px;line-height:1.6}
.post-box{max-width:600px;margin:0 auto 40px;padding:0 20px}
.post-box textarea{width:100%;min-height:56px;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;line-height:1.5;resize:vertical;outline:none;transition:border-color .2s}
.post-box textarea:focus{border-color:var(--accent)}
.post-box textarea::placeholder{color:#3d4452}
.post-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.post-name{width:140px;padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;outline:none}
.post-name::placeholder{color:#3d4452}
.post-btn{padding:8px 20px;background:var(--accent);color:#000;font-weight:700;border:none;border-radius:6px;font-size:13px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background .15s}
.post-btn:hover{background:#00d48c}
.post-btn:disabled{background:var(--surface2);color:var(--muted);cursor:default}
.feed{max-width:900px;margin:0 auto;padding:0 20px 80px}
.entry{display:grid;grid-template-columns:1fr 1fr;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:12px;animation:fadeIn .3s ease}
@media(max-width:600px){.entry{grid-template-columns:1fr}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.entry-raw,.entry-scored{padding:16px}
.entry-raw{background:var(--surface);border-right:1px solid var(--border)}
.entry-scored{background:var(--surface2)}
@media(max-width:600px){.entry-raw{border-right:none;border-bottom:1px solid var(--border)}}
.entry-header{font-family:'JetBrains Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:8px}
.entry-text{font-size:14px;line-height:1.6;word-break:break-word}
.entry-author{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);margin-top:8px}
.score-pill{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700;margin-bottom:8px}
.score-pill.high{color:var(--accent)}.score-pill.mid{color:var(--amber)}.score-pill.low{color:var(--red)}
.fm-tag{font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 6px;border-radius:3px;margin-right:4px;margin-bottom:4px;display:inline-block}
.fm-tag.red{background:rgba(239,68,68,.15);color:var(--red)}
.fm-tag.amber{background:rgba(245,158,11,.15);color:var(--amber)}
.fm-tag.green{background:rgba(0,232,156,.1);color:var(--accent)}
.tilt-mini{font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 6px;border-radius:3px;background:var(--surface);color:var(--amber);margin-right:3px;display:inline-block;margin-top:4px}
.empty{text-align:center;padding:60px 20px;color:var(--muted);font-family:'JetBrains Mono',monospace;font-size:14px}
.spinner{display:inline-block;width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
{% endblock %}

{% block content %}
<div class="hero">
  <h1>The Wall</h1>
  <p>Say anything. The scoring engine doesn't care what you think — it measures how you said it.<br>Every comment scored live. Raw on the left. Structural analysis on the right.</p>
</div>
<div class="post-box">
  <textarea id="commentInput" placeholder="Write something. Anything. The worse, the better the demo." maxlength="1000"></textarea>
  <div class="post-row">
    <input type="text" id="nameInput" class="post-name" placeholder="Name (optional)" maxlength="40">
    <button class="post-btn" id="postBtn" onclick="postComment()">Post & Score</button>
  </div>
</div>
<div class="feed" id="feed">
  <div class="empty" id="emptyState">No comments yet. Be the first to hit the wall.</div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/nti-score-component.js"></script>

<script src="/static/nti-engine.js"></script>


<script>
let comments=[];
async function postComment(){const text=document.getElementById('commentInput').value.trim();if(!text)return;const name=document.getElementById('nameInput').value.trim()||'Anonymous';const btn=document.getElementById('postBtn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>Scoring...';try{const r=await fetch('/nti',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})});const d=await r.json();const entry={text,name,time:new Date().toLocaleTimeString(),score:d};comments.unshift(entry);renderFeed();document.getElementById('commentInput').value='';document.getElementById('nameInput').value=''}catch(e){alert('Score failed: '+e.message)}finally{btn.disabled=false;btn.textContent='Post & Score'}}
function renderFeed(){const feed=document.getElementById('feed');document.getElementById('emptyState').style.display=comments.length?'none':'block';
  // Remove old entries (keep empty state)
  feed.querySelectorAll('.entry').forEach(e=>e.remove());
  comments.forEach((c,i)=>{
    const entry=document.createElement('div');entry.className='entry';
    const rawDiv=document.createElement('div');rawDiv.className='entry-raw';
    rawDiv.innerHTML=`<div class="entry-header">Raw comment</div><div class="entry-text">${esc(c.text)}</div><div class="entry-author">${esc(c.name)} · ${c.time}</div>`;
    const scoredDiv=document.createElement('div');scoredDiv.className='entry-scored';
    scoredDiv.innerHTML='<div class="entry-header">NTI structural analysis</div>';
    scoredDiv.appendChild(NTIScore.render(c.score,c.text));
    entry.appendChild(rawDiv);entry.appendChild(scoredDiv);
    feed.appendChild(entry);
  });
}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
</script>

<script>
// Wall: score each comment server-side via NTI.score
window.ntiScore = NTI.score;
</script>


{% endblock %}
