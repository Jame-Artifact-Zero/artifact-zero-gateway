{% extends "base.html" %}
{% block title %}The Wall — Artifact Zero{% endblock %}
{% block body_class %}page-wall{% endblock %}

{% block head %}
<style>
.az-wall-hero{max-width:700px;margin:0 auto;padding:100px 20px 32px;text-align:center}
.az-wall-hero h1{font-family:var(--az-mono);font-size:clamp(20px,4vw,32px);font-weight:700;margin-bottom:8px}
.az-wall-hero p{color:var(--muted);font-size:14px;line-height:1.6}
.az-post-box{max-width:600px;margin:0 auto 40px;padding:0 20px}
.az-post-box textarea{width:100%;min-height:56px;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:var(--az-sans);font-size:14px;line-height:1.5;resize:vertical;outline:none;transition:border-color .2s}
.az-post-box textarea:focus{border-color:var(--accent)}
.az-post-box textarea::placeholder{color:#3d4452}
.az-post-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.az-post-name{width:140px;padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;outline:none}
.az-post-name::placeholder{color:#3d4452}
.az-post-btn{padding:8px 20px;background:var(--accent);color:#000;font-weight:700;border:none;border-radius:6px;font-size:13px;cursor:pointer;font-family:var(--az-sans);transition:background .15s}
.az-post-btn:hover{background:#00d48c}
.az-post-btn:disabled{background:var(--surface2);color:var(--muted);cursor:default}
.az-feed{max-width:900px;margin:0 auto;padding:0 20px 80px}
.az-entry{display:grid;grid-template-columns:1fr 1fr;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:12px;animation:fadeIn .3s ease}
@media(max-width:600px){.az-entry{grid-template-columns:1fr}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.az-entry-raw{padding:16px;background:var(--surface);border-right:1px solid var(--border)}
.az-entry-scored{padding:16px;background:var(--surface2)}
@media(max-width:600px){.az-entry-raw{border-right:none;border-bottom:1px solid var(--border)}}
.az-entry-header{font-family:var(--az-mono);font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:8px}
.az-entry-text{font-size:14px;line-height:1.6;word-break:break-word}
.az-entry-author{font-family:var(--az-mono);font-size:11px;color:var(--muted);margin-top:8px}
.az-empty{text-align:center;padding:60px 20px;color:var(--muted);font-family:var(--az-mono);font-size:14px}
.az-spinner{display:inline-block;width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
{% endblock %}

{% block content %}
<div class="az-wall-hero">
  <h1>The Wall</h1>
  <p>Say anything. The scoring engine doesn't care what you think — it measures how you said it.<br>Every comment scored live. Raw on the left. Structural analysis on the right.</p>
</div>
<div class="az-post-box">
  <textarea id="commentInput" placeholder="Write something. Anything. The worse, the better the demo." maxlength="1000"></textarea>
  <div class="az-post-row">
    <input type="text" id="nameInput" class="az-post-name" placeholder="Name (optional)" maxlength="40">
    <button class="az-post-btn" id="postBtn" onclick="postComment()">Post & Score</button>
  </div>
</div>
<div class="az-feed" id="feed">
  <div class="az-empty" id="emptyState">No comments yet. Be the first to hit the wall.</div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/nti-score-component.js"></script>
<script src="/static/nti-engine.js"></script>
<script>
var comments=[];
async function postComment(){var text=document.getElementById('commentInput').value.trim();if(!text)return;var name=document.getElementById('nameInput').value.trim()||'Anonymous';var btn=document.getElementById('postBtn');btn.disabled=true;btn.innerHTML='<span class="az-spinner"></span>Scoring...';try{var r=await fetch('/nti',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:text})});var d=await r.json();var entry={text:text,name:name,time:new Date().toLocaleTimeString(),score:d};comments.unshift(entry);renderFeed();document.getElementById('commentInput').value='';document.getElementById('nameInput').value=''}catch(e){alert('Score failed: '+e.message)}finally{btn.disabled=false;btn.textContent='Post & Score'}}
function renderFeed(){var feed=document.getElementById('feed');document.getElementById('emptyState').style.display=comments.length?'none':'block';feed.querySelectorAll('.az-entry').forEach(function(e){e.remove()});comments.forEach(function(c){var entry=document.createElement('div');entry.className='az-entry';var rawDiv=document.createElement('div');rawDiv.className='az-entry-raw';rawDiv.innerHTML='<div class="az-entry-header">Raw comment</div><div class="az-entry-text">'+esc(c.text)+'</div><div class="az-entry-author">'+esc(c.name)+' &middot; '+c.time+'</div>';var scoredDiv=document.createElement('div');scoredDiv.className='az-entry-scored';scoredDiv.innerHTML='<div class="az-entry-header">NTI structural analysis</div>';scoredDiv.appendChild(NTIScore.render(c.score,c.text));entry.appendChild(rawDiv);entry.appendChild(scoredDiv);feed.appendChild(entry)})}
function esc(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML}
window.ntiScore=typeof NTI!=='undefined'?NTI.score:null;
</script>
{% endblock %}
