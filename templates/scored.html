<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title id="pageTitle">Scorecard â€” Artifact Zero</title>
<link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0c10;--surface:#12151b;--surface2:#1a1e27;--border:#252a35;--text:#e8eaf0;--muted:#6b7280;--accent:#22c55e;--red:#ef4444;--amber:#f59e0b;--blue:#3b82f6}
*{margin:0;padding:0;box-sizing:border-box}
html,body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;-webkit-font-smoothing:antialiased;min-height:100vh}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

.topbar{position:fixed;top:0;left:0;right:0;z-index:200;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;background:rgba(10,12,16,.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid rgba(37,42,53,.5)}
.topbar .logo{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:14px;letter-spacing:2px;color:var(--accent);text-decoration:none}
.topbar nav{display:flex;gap:18px}
.topbar nav a{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);text-decoration:none;letter-spacing:1.5px;text-transform:uppercase;transition:color .15s}
.topbar nav a:hover{color:var(--text)}

.content{max-width:1000px;margin:0 auto;padding:80px 16px 40px}

/* Company header */
.company-header{text-align:center;padding:20px 0 28px}
.ch-rank{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
.ch-name{font-size:clamp(24px,5vw,36px);font-weight:700;margin-bottom:8px}
.ch-url{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted)}
.ch-url a{color:var(--blue);text-decoration:none}

/* Score hero */
.score-hero{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin-bottom:28px}
.sh-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 24px;text-align:center;min-width:100px}
.sh-val{font-family:'JetBrains Mono',monospace;font-size:32px;font-weight:700}
.sh-val.good{color:var(--accent)}.sh-val.mid{color:var(--amber)}.sh-val.bad{color:var(--red)}
.sh-label{font-size:10px;color:var(--muted);margin-top:4px;letter-spacing:.5px;text-transform:uppercase}
.sh-card.issues .sh-val{color:var(--red)}
.sh-card.clear .sh-val{color:var(--accent)}

/* Split view */
.split{display:grid;grid-template-columns:1fr 1fr;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:20px}
.split-header{padding:10px 16px;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;border-bottom:1px solid var(--border)}
.split-header.copy-h{background:rgba(59,130,246,.06);color:var(--blue);border-right:1px solid var(--border)}
.split-header.score-h{background:rgba(34,197,94,.06);color:var(--accent)}
.split-col{padding:16px;font-size:13px;line-height:1.8}
.split-col.copy-col{border-right:1px solid var(--border);color:var(--muted);max-height:500px;overflow-y:auto}
.split-col.score-col{max-height:500px;overflow-y:auto}

/* Score details */
.sd-section{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--accent);letter-spacing:1px;text-transform:uppercase;margin:16px 0 8px;padding-top:10px;border-top:1px solid var(--border)}
.sd-section:first-child{margin-top:0;padding-top:0;border-top:none}
.sd-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;font-size:12px;border-bottom:1px solid rgba(37,42,53,.5)}
.sd-row:last-child{border:none}
.sd-label{color:var(--muted)}
.sd-val{font-family:'JetBrains Mono',monospace;font-weight:600;font-size:11px}
.sd-clear{color:var(--accent)}.sd-warn{color:var(--amber)}.sd-crit{color:var(--red)}
.sd-tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}
.sd-tag{font-family:'JetBrains Mono',monospace;font-size:9px;padding:3px 8px;border-radius:4px;background:var(--surface2);color:var(--amber)}
.sd-finding{padding:8px 10px;margin-top:6px;border-radius:6px;font-size:12px;line-height:1.6;background:rgba(34,197,94,.06);border-left:3px solid var(--accent);color:var(--text)}

/* Share + Meta */
.meta-row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:20px}
.meta-left{font-size:11px;color:var(--muted)}
.meta-left span{font-family:'JetBrains Mono',monospace}
.share-btn{padding:8px 18px;background:var(--surface);border:1px solid var(--border);border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--accent);cursor:pointer;transition:all .15s}
.share-btn:hover{border-color:var(--accent);background:var(--surface2)}
.share-btn.copied{background:#14532d;border-color:var(--accent)}

/* Bottom CTAs */
.bottom-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;padding:20px 0 40px}
.bottom-row a{padding:12px 24px;border-radius:8px;font-size:13px;font-weight:600;text-decoration:none;font-family:'DM Sans',sans-serif;transition:all .15s}
.btn-check{background:var(--accent);color:#0a0c10}
.btn-check:hover{background:#16a34a}
.btn-back{background:var(--surface);color:var(--text);border:1px solid var(--border)}
.btn-back:hover{border-color:var(--accent);color:var(--accent)}

/* Loading */
.loading{text-align:center;padding:60px 20px;font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--muted)}

@media(max-width:700px){
  .split{grid-template-columns:1fr}
  .split-header.copy-h{border-right:none}
  .split-col.copy-col{border-right:none;border-bottom:1px solid var(--border);max-height:300px}
  .score-hero{gap:10px}
  .sh-card{padding:12px 16px;min-width:80px}
  .sh-val{font-size:24px}
}
</style>
</head>
<body>

<div class="topbar">
  <a href="/" class="logo">ARTIFACT ZERO</a>
  <nav>
    <a href="/fortune500">F500</a>
    <a href="/check">CHECK</a>
    <a href="/docs">API</a>
  </nav>
</div>

<div class="content">
  <div id="scorecard">
    <div class="loading">Loading scorecard...</div>
  </div>
</div>

<script>
const slug = window.location.pathname.split('/').pop();

async function loadScorecard(){
  try {
    const res = await fetch('/api/fortune500/' + slug);
    if(!res.ok) throw new Error('Not found');
    const data = await res.json();
    render(data);
  } catch(e){
    document.getElementById('scorecard').innerHTML = '<div class="loading">Company not found. <a href="/fortune500" style="color:var(--accent)">Back to list</a></div>';
  }
}

function scoreClass(nii){
  if(nii >= 0.7) return 'good';
  if(nii >= 0.4) return 'mid';
  return 'bad';
}

function render(c){
  const nii = c.nii_score || 0;
  const issues = c.issue_count || 0;
  const score = c.score_json ? JSON.parse(c.score_json) : {};
  const checked = c.last_checked ? new Date(c.last_checked).toLocaleDateString('en-US', {month:'short',day:'numeric',year:'numeric'}) : '';

  document.getElementById('pageTitle').textContent = c.company_name + ' Structure Check â€” Artifact Zero';

  // Parse score data â€” handle multiple response shapes
  const fm = score.failure_modes || score.parent_failure_modes || {};
  const tilt = score.tilt_taxonomy || score.tilt || {};
  const tiltTags = Array.isArray(tilt) ? tilt : (tilt.tags || []);
  const tiltCount = Array.isArray(tilt) ? tilt.length : (tilt.count || 0);
  const niiData = score.nii || score.score || {};
  const components = niiData.components || {};
  const latency = score.telemetry?.latency_ms || score.meta?.latency_ms || 'â€”';

  // Failure mode states
  function fmState(key){
    const v = fm[key];
    if(!v) return 'CLEAR';
    if(typeof v === 'string') return v.includes('FALSE') ? 'CLEAR' : v.replace('_',' ');
    const st = v[key.toLowerCase()+'_state'] || v[key+'_state'] || '';
    return st.includes('FALSE') ? 'CLEAR' : st.replace('_',' ');
  }
  function fmCls(key){
    const s = fmState(key);
    return s === 'CLEAR' ? 'sd-clear' : s.includes('PROBABLE') ? 'sd-warn' : 'sd-crit';
  }

  // Structural checks
  const checks = [
    [(components.q1||niiData.q1_constraints_explicit||0) >= 0.7, 'Constraints explicit'],
    [(components.q2||niiData.q2_constraints_before_capability||0) >= 0.7, 'Ask before context'],
    [(components.q3||niiData.q3_substitutes_after_enforcement||0) >= 0.7, 'Boundary enforced'],
    [(components.q4||0) >= 0.7, 'Objective clear'],
  ];

  // Plain language findings
  const findings = [];
  if(!checks[0][0]) findings.push('No explicit constraints â€” readers interpret freely.');
  if(!checks[1][0]) findings.push('Key information buried â€” may not be read.');
  if(!checks[2][0]) findings.push('No enforcement boundary â€” commitments can be deferred.');
  if(!checks[3][0]) findings.push('Objective unclear â€” visitor may not understand the ask.');
  if(fmState('UDDS') !== 'CLEAR') findings.push('Benefits presented before constraints are established.');
  if(fmState('DCE') !== 'CLEAR') findings.push('Accountability deferred to future interaction.');
  if(fmState('CCA') !== 'CLEAR') findings.push('Multiple distinct claims collapsed into vague statements.');

  let html = `
    <div class="company-header">
      <div class="ch-rank">Fortune 500 Â· #${c.rank || 'â€”'}</div>
      <div class="ch-name">${c.company_name}</div>
      <div class="ch-url"><a href="${c.url}" target="_blank" rel="noopener">${c.url}</a></div>
    </div>

    <div class="score-hero">
      <div class="sh-card">
        <div class="sh-val ${scoreClass(nii)}">${(nii*100).toFixed(0)}%</div>
        <div class="sh-label">Structure Score</div>
      </div>
      <div class="sh-card ${issues>0?'issues':'clear'}">
        <div class="sh-val">${issues>0?issues:'0'}</div>
        <div class="sh-label">${issues>0?'Issues Found':'Clean'}</div>
      </div>
      <div class="sh-card">
        <div class="sh-val" style="color:var(--blue)">${latency}${typeof latency==='number'?'ms':''}</div>
        <div class="sh-label">Latency</div>
      </div>
    </div>

    <div class="meta-row">
      <div class="meta-left">Last checked: <span>${checked || 'pending'}</span></div>
      <button class="share-btn" onclick="shareCard()">&#128279; Share this scorecard</button>
    </div>

    <div class="split">
      <div class="split-header copy-h">Their Homepage Copy</div>
      <div class="split-header score-h">Structure Check</div>
    </div>
    <div class="split">
      <div class="split-col copy-col">${(c.homepage_copy||'Copy not yet captured.').replace(/\n/g,'<br>')}</div>
      <div class="split-col score-col">
        ${findings.length > 0 ? '<div class="sd-section">What We Found</div>' + findings.map(f => '<div class="sd-finding">'+f+'</div>').join('') : '<div class="sd-finding" style="border-color:var(--accent)">No structural issues detected. This copy is clear.</div>'}

        <div class="sd-section">Failure Modes</div>
        <div class="sd-row"><span class="sd-label">UDDS</span><span class="sd-val ${fmCls('UDDS')}">${fmState('UDDS')}</span></div>
        <div class="sd-row"><span class="sd-label">DCE</span><span class="sd-val ${fmCls('DCE')}">${fmState('DCE')}</span></div>
        <div class="sd-row"><span class="sd-label">CCA</span><span class="sd-val ${fmCls('CCA')}">${fmState('CCA')}</span></div>

        ${tiltCount > 0 ? '<div class="sd-section">Tilt Patterns</div><div class="sd-tags">' + tiltTags.map(t => '<span class="sd-tag">'+t+'</span>').join('') + '</div>' : ''}

        <div class="sd-section">Checklist</div>
        ${checks.map(([pass,label]) => '<div class="sd-row"><span class="sd-label">'+label+'</span><span class="sd-val '+(pass?'sd-clear':'sd-crit')+'">'+(pass?'&#10003;':'&#10007;')+'</span></div>').join('')}
      </div>
    </div>

    <div class="bottom-row">
      <a class="btn-check" href="/check">Check your own words &rarr;</a>
      <a class="btn-back" href="/fortune500">&larr; All 500 companies</a>
    </div>
  `;

  document.getElementById('scorecard').innerHTML = html;
}

function shareCard(){
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => {
    const btn = document.querySelector('.share-btn');
    btn.textContent = 'âœ“ Copied';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'ðŸ”— Share this scorecard'; btn.classList.remove('copied'); }, 2000);
  });
}

loadScorecard();
</script>
<script src="/static/az-mobile-audit.js" data-mode="silent"></script>
<script src="/static/az-nav.js"></script>
</body>
</html>
