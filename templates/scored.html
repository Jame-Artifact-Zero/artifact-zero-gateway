<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title id="pageTitle">Scorecard â€” Artifact Zero</title>
<link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0c10;--surface:#12151b;--surface2:#1a1e27;--border:#252a35;--text:#e8eaf0;--muted:#6b7280;--accent:#00e89c;--red:#ef4444;--amber:#f59e0b;--blue:#3b82f6}
*{margin:0;padding:0;box-sizing:border-box}
html,body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;-webkit-font-smoothing:antialiased;min-height:100vh}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

.topbar{position:fixed;top:0;left:0;right:0;z-index:200;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;background:rgba(10,12,16,.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid rgba(37,42,53,.5)}
.topbar .logo{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:14px;letter-spacing:2px;color:var(--accent);text-decoration:none}
.topbar nav{display:flex;gap:18px}
.topbar nav a{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);text-decoration:none;letter-spacing:1.5px;text-transform:uppercase;transition:color .15s}
.topbar nav a:hover{color:var(--text)}

.content{max-width:1000px;margin:0 auto;padding:80px 16px 40px}

/* Company header */
.company-header{text-align:center;padding:20px 0 28px}
.ch-rank{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
.ch-name{font-size:clamp(24px,5vw,36px);font-weight:700;margin-bottom:8px}
.ch-url{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted)}
.ch-url a{color:var(--blue);text-decoration:none}

/* Score hero */
.score-hero{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin-bottom:28px}
.sh-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 24px;text-align:center;min-width:100px}
.sh-val{font-family:'JetBrains Mono',monospace;font-size:32px;font-weight:700}
.sh-val.good{color:var(--accent)}.sh-val.mid{color:var(--amber)}.sh-val.bad{color:var(--red)}
.sh-label{font-size:10px;color:var(--muted);margin-top:4px;letter-spacing:.5px;text-transform:uppercase}
.sh-card.issues .sh-val{color:var(--red)}
.sh-card.clear .sh-val{color:var(--accent)}

/* Split view */
.split{display:grid;grid-template-columns:1fr 1fr;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:20px}
.split-header{padding:10px 16px;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;border-bottom:1px solid var(--border)}
.split-header.copy-h{background:rgba(59,130,246,.06);color:var(--blue);border-right:1px solid var(--border)}
.split-header.score-h{background:rgba(0,232,156,.06);color:var(--accent)}
.split-col{padding:16px;font-size:13px;line-height:1.8}
.split-col.copy-col{border-right:1px solid var(--border);color:var(--muted);max-height:500px;overflow-y:auto}
.split-col.score-col{max-height:500px;overflow-y:auto}

/* Score details */
.sd-section{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--accent);letter-spacing:1px;text-transform:uppercase;margin:16px 0 8px;padding-top:10px;border-top:1px solid var(--border)}
.sd-section:first-child{margin-top:0;padding-top:0;border-top:none}
.sd-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;font-size:12px;border-bottom:1px solid rgba(37,42,53,.5)}
.sd-row:last-child{border:none}
.sd-label{color:var(--muted)}
.sd-val{font-family:'JetBrains Mono',monospace;font-weight:600;font-size:11px}
.sd-clear{color:var(--accent)}.sd-warn{color:var(--amber)}.sd-crit{color:var(--red)}
.sd-tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}
.sd-tag{font-family:'JetBrains Mono',monospace;font-size:9px;padding:3px 8px;border-radius:4px;background:var(--surface2);color:var(--amber)}
.sd-finding{padding:8px 10px;margin-top:6px;border-radius:6px;font-size:12px;line-height:1.6;background:rgba(0,232,156,.06);border-left:3px solid var(--accent);color:var(--text)}

/* Findings cards */
.findings-section{margin-bottom:24px}
.finding-card{padding:12px 14px;margin-bottom:8px;border-radius:8px;border-left:3px solid}
.finding-card.high{background:rgba(239,68,68,.08);border-color:var(--red)}
.finding-card.medium{background:rgba(245,158,11,.08);border-color:var(--amber)}
.finding-card.pass{background:rgba(0,232,156,.06);border-color:var(--accent)}
.finding-dim{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;margin-bottom:4px}
.finding-text{font-size:13px;line-height:1.6;color:var(--text)}
.finding-evidence{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);margin-top:4px;padding:4px 8px;background:rgba(255,255,255,.03);border-radius:4px}

/* Dimension grid */
.dim-grid{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}
.dim-row{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px 14px}
.dim-header{display:flex;justify-content:space-between;align-items:center}
.dim-name{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;color:var(--text)}
.dim-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700}
.dim-desc{font-size:11px;color:var(--muted);margin:4px 0 8px}
.dim-bar-bg{height:6px;background:var(--surface2);border-radius:3px;overflow:hidden}
.dim-bar{height:100%;border-radius:3px;transition:width .3s}
.dim-bar.sd-clear{background:var(--accent)}.dim-bar.sd-warn{background:var(--amber)}.dim-bar.sd-crit{background:var(--red)}
.dim-weight{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--muted);margin-top:4px;text-align:right}

/* Share + Meta */
.meta-row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:20px}
.meta-left{font-size:11px;color:var(--muted)}
.meta-left span{font-family:'JetBrains Mono',monospace}
.share-btn{padding:8px 18px;background:var(--surface);border:1px solid var(--border);border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--accent);cursor:pointer;transition:all .15s}
.share-btn:hover{border-color:var(--accent);background:var(--surface2)}
.share-btn.copied{background:#064e3b;border-color:var(--accent)}

/* Bottom CTAs */
.bottom-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;padding:20px 0 40px}
.bottom-row a{padding:12px 24px;border-radius:8px;font-size:13px;font-weight:600;text-decoration:none;font-family:'DM Sans',sans-serif;transition:all .15s}
.btn-check{background:var(--accent);color:#0a0c10}
.btn-check:hover{background:#00d48c}
.btn-back{background:var(--surface);color:var(--text);border:1px solid var(--border)}
.btn-back:hover{border-color:var(--accent);color:var(--accent)}

/* Loading */
.loading{text-align:center;padding:60px 20px;font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--muted)}

@media(max-width:700px){
  .split{grid-template-columns:1fr}
  .split-header.copy-h{border-right:none}
  .split-col.copy-col{border-right:none;border-bottom:1px solid var(--border);max-height:300px}
  .score-hero{gap:10px}
  .sh-card{padding:12px 16px;min-width:80px}
  .sh-val{font-size:24px}
}
</style>
</head>
<body>

<!-- topbar removed: az-shell.js -->
<div class="content">
  <div id="scorecard">
    <div class="loading">Loading scorecard...</div>
  </div>
</div>

<script>
const slug = window.location.pathname.split('/').pop();

async function loadScorecard(){
  try {
    const res = await fetch('/api/fortune500/' + slug);
    if(!res.ok) throw new Error('Not found');
    const data = await res.json();
    render(data);
  } catch(e){
    document.getElementById('scorecard').innerHTML = '<div class="loading">Company not found. <a href="/fortune500" style="color:var(--accent)">Back to list</a></div>';
  }
}

function scoreClass(nii){
  const v = nii > 1 ? nii : nii * 100;
  if(v >= 70) return 'good';
  if(v >= 40) return 'mid';
  return 'bad';
}

function render(c){
  const csi = c.csi || {};
  const score = csi.score || c.nii_score || 0;
  const label = csi.label || '';
  const dims = csi.dimensions || {};
  const detail = csi.detail || {};
  const findings = csi.findings || [];
  const meta = csi.meta || {};
  const checked = c.last_checked ? new Date(c.last_checked).toLocaleDateString('en-US', {month:'short',day:'numeric',year:'numeric'}) : '';

  document.getElementById('pageTitle').textContent = c.company_name + ' Structure Check â€” Artifact Zero';

  const rankLabel = c.rank ? (c.fund_name ? 'VC Fund Â· #' : 'Fortune 500 Â· #') + c.rank : '';

  function sc(v){ return v >= 0.7 ? 'sd-clear' : v >= 0.45 ? 'sd-warn' : 'sd-crit'; }
  function pct(v){ return (v * 100).toFixed(1) + '%'; }

  const dimLabels = {
    d1_specificity: {name: 'D1 â€” Specificity Index', desc: 'Measurable claims with numbers, dates, metrics'},
    d2_commitment: {name: 'D2 â€” Commitment Integrity', desc: 'Verifiable commitments vs aspirational language'},
    d3_clarity: {name: 'D3 â€” Structural Clarity', desc: 'Sentence structure quality and readability'},
    d4_hedge_density: {name: 'D4 â€” Hedge Density', desc: 'Absence of qualifying/hedging language'},
    d5_tilt_exposure: {name: 'D5 â€” Tilt Exposure', desc: 'Resistance to NTI drift patterns'},
    d6_empty_commitments: {name: 'D6 â€” Empty Commitments', desc: 'Claims backed by evidence vs hollow statements'},
    d7_objective_anchor: {name: 'D7 â€” Objective Anchor', desc: 'Clear WHO, WHAT, and constraints identified'},
    d8_accountability: {name: 'D8 â€” Accountability', desc: 'Measurement, reporting, timeline language'},
    d9_redundancy: {name: 'D9 â€” Redundancy', desc: 'Semantic efficiency (low repetition and filler)'},
    d10_differentiation: {name: 'D10 â€” Differentiation', desc: 'Unique language vs generic corporate copy'},
  };

  const weights = csi.weights || {};
  const hiFindings = findings.filter(f => f.severity === 'high');
  const medFindings = findings.filter(f => f.severity === 'medium');
  const passFindings = findings.filter(f => f.severity === 'pass');

  let html = `
    <div class="company-header">
      <div class="ch-rank">${rankLabel}</div>
      <div class="ch-name">${c.company_name}</div>
      <div class="ch-url"><a href="${c.url}" target="_blank" rel="noopener">${c.url}</a></div>
    </div>

    <div class="score-hero">
      <div class="sh-card">
        <div class="sh-val ${score>=70?'good':score>=45?'mid':'bad'}">${score.toFixed(1)}%</div>
        <div class="sh-label">CSI Score</div>
      </div>
      <div class="sh-card">
        <div class="sh-val" style="color:${label.includes('SOUND')?'var(--accent)':label.includes('CLEAR')?'var(--blue)':'var(--amber)'}">${label}</div>
        <div class="sh-label">Rating</div>
      </div>
      <div class="sh-card ${hiFindings.length>0?'issues':'clear'}">
        <div class="sh-val">${hiFindings.length + medFindings.length}</div>
        <div class="sh-label">Findings</div>
      </div>
      <div class="sh-card">
        <div class="sh-val" style="color:var(--blue)">${meta.sentence_count || 'â€”'}</div>
        <div class="sh-label">Sentences</div>
      </div>
    </div>

    <div class="meta-row">
      <div class="meta-left">Last checked: <span>${checked || 'pending'}</span> Â· <span>${meta.word_count || '?'} words analyzed</span> Â· <span>CSI v1.0</span></div>
      <button class="share-btn" onclick="shareCard()">&#128279; Share this scorecard</button>
    </div>

    <!-- FINDINGS -->
    ${findings.length > 0 ? `
    <div class="findings-section">
      <div class="sd-section" style="border:none;padding:0;margin:0 0 10px">FINDINGS</div>
      ${hiFindings.map(f => `
        <div class="finding-card high">
          <div class="finding-dim">${f.dimension}</div>
          <div class="finding-text">${f.finding}</div>
          ${f.evidence ? '<div class="finding-evidence">'+f.evidence+'</div>' : ''}
        </div>
      `).join('')}
      ${medFindings.map(f => `
        <div class="finding-card medium">
          <div class="finding-dim">${f.dimension}</div>
          <div class="finding-text">${f.finding}</div>
          ${f.evidence ? '<div class="finding-evidence">'+f.evidence+'</div>' : ''}
        </div>
      `).join('')}
      ${passFindings.map(f => `
        <div class="finding-card pass">
          <div class="finding-dim">${f.dimension}</div>
          <div class="finding-text">${f.finding}</div>
        </div>
      `).join('')}
    </div>` : '<div class="finding-card pass" style="margin-bottom:20px"><div class="finding-text">No structural issues detected. This copy is clear.</div></div>'}

    <!-- DIMENSION BREAKDOWN -->
    <div class="sd-section">10-DIMENSION BREAKDOWN</div>
    <div class="dim-grid">
      ${Object.keys(dimLabels).map(k => {
        const v = dims[k] || 0;
        const w = weights[k] || 0;
        const info = dimLabels[k];
        const barW = Math.max(v * 100, 2);
        const cls = sc(v);
        return `
        <div class="dim-row">
          <div class="dim-header">
            <span class="dim-name">${info.name}</span>
            <span class="dim-val ${cls}">${pct(v)}</span>
          </div>
          <div class="dim-desc">${info.desc}</div>
          <div class="dim-bar-bg"><div class="dim-bar ${cls}" style="width:${barW}%"></div></div>
          <div class="dim-weight">Weight: ${(w*100).toFixed(0)}%</div>
        </div>`;
      }).join('')}
    </div>

    <!-- SPLIT VIEW: Copy + Raw Detail -->
    <div class="split" style="margin-top:20px">
      <div class="split-header copy-h">Their Corporate Copy</div>
      <div class="split-header score-h">Raw Dimension Data</div>
    </div>
    <div class="split">
      <div class="split-col copy-col">${(c.homepage_copy||'Copy not yet captured.').replace(/\n/g,'<br>')}</div>
      <div class="split-col score-col" style="font-family:'JetBrains Mono',monospace;font-size:10px;line-height:1.8;color:var(--muted)">
        ${Object.keys(detail).map(k => {
          const d = detail[k];
          if(!d || typeof d !== 'object') return '';
          return '<div style="margin-bottom:12px"><div style="color:var(--accent);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px">'+k.replace(/_/g,' ')+'</div>' +
            Object.keys(d).map(sk => {
              let val = d[sk];
              if(Array.isArray(val)) val = val.length > 0 ? val.slice(0,5).join(', ') : 'â€”';
              else if(typeof val === 'object') val = JSON.stringify(val);
              else if(typeof val === 'number') val = val % 1 === 0 ? val : val.toFixed(3);
              return '<div><span style="color:var(--text)">'+sk+'</span>: '+val+'</div>';
            }).join('') + '</div>';
        }).join('')}
      </div>
    </div>

    <div class="bottom-row">
      <a class="btn-check" href="/safecheck">Check your own words &rarr;</a>
      <a class="btn-back" href="/fortune500">&larr; All companies</a>
    </div>
  `;

  document.getElementById('scorecard').innerHTML = html;
}

function shareCard(){
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => {
    const btn = document.querySelector('.share-btn');
    btn.textContent = 'âœ“ Copied';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'ðŸ”— Share this scorecard'; btn.classList.remove('copied'); }, 2000);
  });
}

loadScorecard();
</script>
<script src="/static/az-mobile-audit.js" data-mode="silent"></script>
<script src="/static/az-nav.js"></script>

<script src="/static/az-shell.js"></script>
</body>
</html>
