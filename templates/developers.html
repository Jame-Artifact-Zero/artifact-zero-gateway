{% extends "base.html" %}
{% block title %}Developer Access — Artifact Zero{% endblock %}
{% block body_class %}page-developers{% endblock %}

{% block head %}
<style>
.wrap{max-width:520px;margin:0 auto;padding:100px 20px 60px;min-height:80vh;display:flex;flex-direction:column;justify-content:center}
h1{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700;margin-bottom:6px}
.sub{color:var(--muted);font-size:14px;margin-bottom:32px;line-height:1.5}
.field{margin-bottom:20px}
.field label{display:block;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px}
.field input,.field textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-size:14px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s}
.field input:focus,.field textarea:focus{border-color:var(--accent)}
.field textarea{min-height:100px;resize:vertical}
.field input::placeholder,.field textarea::placeholder{color:#4b5563}
.send-btn{width:100%;padding:14px;background:var(--accent);color:#000;font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;border:none;border-radius:8px;cursor:pointer;letter-spacing:1px;transition:opacity .2s}
.send-btn:hover{opacity:.9}
.send-btn:disabled{opacity:.4;cursor:default}
.err{color:var(--red);font-size:12px;margin-top:4px;font-family:'JetBrains Mono',monospace}
</style>
{% endblock %}

{% block content %}
<div class="wrap" id="formWrap">
  <h1>Developer & Vendor Access</h1>
  <p class="sub">NTI infrastructure is available to approved developers and integration partners. Tell us what you're building.</p>
  <div class="field">
    <label>Name</label>
    <input type="text" id="dName" placeholder="First and last name" required>
  </div>
  <div class="field">
    <label>Email</label>
    <input type="email" id="dEmail" placeholder="you@company.com" required>
  </div>
  <div class="field">
    <label>What are you building?</label>
    <textarea id="dMessage" placeholder="Tell us about your integration, product, or use case."></textarea>
  </div>
  <button class="send-btn" id="sendBtn" onclick="submitDev()">Request access</button>
  <div class="err" id="errMsg"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function submitDev(){
  const name = document.getElementById('dName').value.trim();
  const email = document.getElementById('dEmail').value.trim();
  const message = document.getElementById('dMessage').value.trim();
  const err = document.getElementById('errMsg');
  err.textContent = '';

  if(!name || name.split(' ').length < 2){
    err.textContent = 'First and last name required.'; return;
  }
  if(!email || !email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){
    err.textContent = 'Valid email required.'; return;
  }
  if(!message || message.length < 10){
    err.textContent = 'Tell us what you are building.'; return;
  }

  const btn = document.getElementById('sendBtn');
  btn.disabled = true;
  btn.textContent = 'Sending...';

  try{
    const r = await fetch('/api/developer-apply', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({name, email, message, type:'developer_apply'})
    });
    if(r.ok){
      document.getElementById('formWrap').innerHTML =
        '<h1 style="color:var(--accent)">Got it.</h1>' +
        '<p class="sub" style="margin-top:12px">We will review your request and get back to you. Check your email.</p>' +
        '<a href="/" style="color:var(--accent);font-family:\'JetBrains Mono\',monospace;font-size:13px;margin-top:20px;display:inline-block">← Back to Artifact Zero</a>';
    } else {
      const d = await r.json().catch(()=>({}));
      err.textContent = d.error || 'Something went wrong. Try again.';
      btn.disabled = false;
      btn.textContent = 'Request access';
    }
  } catch(e){
    err.textContent = 'Network error. Try again.';
    btn.disabled = false;
    btn.textContent = 'Request access';
  }
}
</script>

{% endblock %}
